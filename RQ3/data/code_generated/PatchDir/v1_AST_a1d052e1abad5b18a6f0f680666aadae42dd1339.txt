OBJECT [0,3265]
    FIELD [1,42]
        String: "name" [1,7]
        STRING [8,42]
            String: "DFFML: Build: Images: Containers" [8,42]
    FIELD [43,126]
        String: "on" [43,47]
        OBJECT [48,126]
            FIELD [49,73]
                String: "workflow_dispatch" [49,68]
                NULL [69,73]
            FIELD [74,125]
                String: "push" [74,80]
                OBJECT [81,125]
                    FIELD [82,101]
                        String: "branches" [82,92]
                        ARRAY [93,101]
                            STRING [94,100]
                                String: "main" [94,100]
                    FIELD [102,124]
                        String: "paths" [102,109]
                        ARRAY [110,124]
                            STRING [111,123]
                                String: "Dockerfile" [111,123]
    FIELD [127,3264]
        String: "jobs" [127,133]
        OBJECT [134,3264]
            FIELD [135,3063]
                String: "manifest" [135,145]
                OBJECT [146,3063]
                    FIELD [147,172]
                        String: "runs-on" [147,156]
                        STRING [157,172]
                            String: "ubuntu-latest" [157,172]
                    FIELD [173,252]
                        String: "outputs" [173,182]
                        OBJECT [183,252]
                            FIELD [184,251]
                                String: "manifest" [184,194]
                                STRING [195,251]
                                    String: "${{ steps.create-manifest-instance.outputs.manifest }}" [195,251]
                    FIELD [253,3062]
                        String: "steps" [253,260]
                        ARRAY [261,3062]
                            OBJECT [262,353]
                                FIELD [263,289]
                                    String: "name" [263,269]
                                    STRING [270,289]
                                        String: "Set up Python 3.9" [270,289]
                                FIELD [290,322]
                                    String: "uses" [290,296]
                                    STRING [297,322]
                                        String: "actions/setup-python@v2" [297,322]
                                FIELD [323,352]
                                    String: "with" [323,329]
                                    OBJECT [330,352]
                                        FIELD [331,351]
                                            String: "python-version" [331,347]
                                            NUMBER [348,351]
                                                Number: 3.9 [348,351]
                            OBJECT [354,384]
                                FIELD [355,383]
                                    String: "uses" [355,361]
                                    STRING [362,383]
                                        String: "actions/checkout@v3" [362,383]
                            OBJECT [385,3061]
                                FIELD [386,434]
                                    String: "name" [386,392]
                                    STRING [393,434]
                                        String: "Build manifest from changed dockerfiles" [393,434]
                                FIELD [435,466]
                                    String: "id" [435,439]
                                    STRING [440,466]
                                        String: "create-manifest-instance" [440,466]
                                FIELD [467,788]
                                    String: "env" [467,472]
                                    OBJECT [473,788]
                                        FIELD [474,485]
                                            String: "PREFIX" [474,482]
                                            STRING [483,485]
                                                String: "" [483,485]
                                        FIELD [486,501]
                                            String: "ROOT_PATH" [486,497]
                                            STRING [498,501]
                                                String: "." [498,501]
                                        FIELD [502,547]
                                            String: "OWNER_REPOSITORY" [502,520]
                                            STRING [521,547]
                                                String: "${{ github.repository }}" [521,547]
                                        FIELD [548,581]
                                            String: "BRANCH" [548,556]
                                            STRING [557,581]
                                                String: "${{ github.ref_name }}" [557,581]
                                        FIELD [582,640]
                                            String: "COMPARE_URL" [582,595]
                                            STRING [596,640]
                                                String: "${{ github.event.repository.compare_url }}" [596,640]
                                        FIELD [641,680]
                                            String: "GH_ACCESS_TOKEN" [641,658]
                                            STRING [659,680]
                                                String: "${{ github.token }}" [659,680]
                                        FIELD [681,715]
                                            String: "HEAD" [681,687]
                                            STRING [688,715]
                                                String: "${{ github.event.after }}" [688,715]
                                        FIELD [716,751]
                                            String: "BASE" [716,722]
                                            STRING [723,751]
                                                String: "${{ github.event.before }}" [723,751]
                                        FIELD [752,787]
                                            String: "BASE_REF" [752,762]
                                            STRING [763,787]
                                                String: "${{ github.base_ref }}" [763,787]
                                FIELD [789,812]
                                    String: "shell" [789,796]
                                    STRING [797,812]
                                        String: "python -u {0}" [797,812]
                                FIELD [813,3060]
                                    String: "run" [813,818]
                                    STRING [819,3060]
                                        String: "import os\nimport json\nimport pathlib\nimport urllib.request\nowner, repository = os.environ[\"OWNER_REPOSITORY\"].split(\"/\", maxsplit=1)\nbase = None\nenv_vars = [\"BASE\", \"BASE_REF\"]\nfor env_var in env_vars:\n    if env_var in os.environ and os.environ[env_var].strip():\n        # Set if present and not blank\n        base = os.environ[env_var]\nif base is None:\n    raise Exception(f\"None of {env_vars!r} found in os.environ\")\ncompare_url = os.environ[\"COMPARE_URL\"]\ncompare_url = compare_url.replace(\"{base}\", base)\ncompare_url = compare_url.replace(\"{head}\", os.environ[\"HEAD\"])\nwith urllib.request.urlopen(\n    urllib.request.Request(\n        compare_url,\n        headers={\n            \"Authorization\": \"bearer \" + os.environ[\"GH_ACCESS_TOKEN\"],\n        },\n    )\n) as response:\n    response_json = json.load(response)\n# Build the most recent commit\ncommit = response_json[\"commits\"][-1][\"sha\"]\n# Path to root of repo\nroot_path = pathlib.Path(os.environ[\"ROOT_PATH\"])\n# Must be a valid directory with .Dockerfiles in it\nprefix_path = pathlib.Path(os.environ[\"PREFIX\"])\nmanifest = list([\n    {\n        \"image_name\": pathlib.Path(compare_file[\"filename\"]).stem,\n        \"dockerfile\": compare_file[\"filename\"],\n        \"owner\": owner,\n        \"repository\": repository,\n        \"branch\": os.environ[\"BRANCH\"],\n        \"commit\": commit,\n    }\n    for compare_file in response_json[\"files\"]\n    if (\n        compare_file[\"filename\"].startswith(os.environ[\"PREFIX\"])\n        and compare_file[\"filename\"].endswith(\"Dockerfile\")\n    )\n])\n# Build everything if we aren't sure why we got here (alice changes or\n# workflow re-run)\nif not manifest:\n    manifest = list([\n        {\n            \"image_name\": path.stem,\n            \"dockerfile\": str(path.relative_to(root_path)),\n            \"owner\": owner,\n            \"repository\": repository,\n            \"branch\": os.environ[\"BRANCH\"],\n            \"commit\": commit,\n        }\n        for path in prefix_path.glob(\"*Dockerfile\")\n    ])\nprint(json.dumps(manifest, sort_keys=True, indent=4))\nprint(\"::set-output name=manifest::\" + json.dumps({\"include\": manifest}))\n" [819,3060]
            FIELD [3064,3263]
                String: "build" [3064,3071]
                OBJECT [3072,3263]
                    FIELD [3073,3091]
                        String: "needs" [3073,3080]
                        STRING [3081,3091]
                            String: "manifest" [3081,3091]
                    FIELD [3092,3148]
                        String: "uses" [3092,3098]
                        STRING [3099,3148]
                            String: "./.github/workflows/build_images_containers.yml" [3099,3148]
                    FIELD [3149,3210]
                        String: "with" [3149,3155]
                        OBJECT [3156,3210]
                            FIELD [3157,3209]
                                String: "manifests" [3157,3168]
                                STRING [3169,3209]
                                    String: "${{ needs.manifest.outputs.manifest }}" [3169,3209]
                    FIELD [3211,3262]
                        String: "secrets" [3211,3220]
                        OBJECT [3221,3262]
                            FIELD [3222,3261]
                                String: "GH_ACCESS_TOKEN" [3222,3239]
                                STRING [3240,3261]
                                    String: "${{ github.token }}" [3240,3261]