OBJECT [0,5864]
    FIELD [1,21]
        String: "name" [1,7]
        STRING [8,21]
            String: "Build on M1" [8,21]
    FIELD [22,215]
        String: "on" [22,26]
        OBJECT [27,215]
            FIELD [28,96]
                String: "pull_request" [28,42]
                OBJECT [43,96]
                    FIELD [44,95]
                        String: "paths" [44,51]
                        ARRAY [52,95]
                            STRING [53,94]
                                String: ".github/workflows/build-m1-binaries.yml" [53,94]
            FIELD [97,189]
                String: "push" [97,103]
                OBJECT [104,189]
                    FIELD [105,146]
                        String: "branches" [105,115]
                        ARRAY [116,146]
                            STRING [117,126]
                                String: "nightly" [117,126]
                            STRING [127,133]
                                String: "main" [127,133]
                            STRING [134,145]
                                String: "release/*" [134,145]
                    FIELD [147,188]
                        String: "tags" [147,153]
                        ARRAY [154,188]
                            STRING [155,187]
                                String: "v[0-9]+.[0-9]+.[0-9]+-rc[0-9]+" [155,187]
            FIELD [190,214]
                String: "workflow_dispatch" [190,209]
                NULL [210,214]
    FIELD [216,243]
        String: "env" [216,221]
        OBJECT [222,243]
            FIELD [223,242]
                String: "CHANNEL" [223,232]
                STRING [233,242]
                    String: "nightly" [233,242]
    FIELD [244,5863]
        String: "jobs" [244,250]
        OBJECT [251,5863]
            FIELD [252,3720]
                String: "build_wheels" [252,266]
                OBJECT [267,3720]
                    FIELD [268,304]
                        String: "name" [268,274]
                        STRING [275,304]
                            String: "Build TorchVision M1 wheels" [275,304]
                    FIELD [305,328]
                        String: "runs-on" [305,314]
                        STRING [315,328]
                            String: "macos-m1-12" [315,328]
                    FIELD [329,383]
                        String: "strategy" [329,339]
                        OBJECT [340,383]
                            FIELD [341,382]
                                String: "matrix" [341,349]
                                OBJECT [350,382]
                                    FIELD [351,381]
                                        String: "py_vers" [351,360]
                                        ARRAY [361,381]
                                            STRING [362,367]
                                                String: "3.8" [362,367]
                                            STRING [368,373]
                                                String: "3.9" [368,373]
                                            STRING [374,380]
                                                String: "3.10" [374,380]
                    FIELD [384,3719]
                        String: "steps" [384,391]
                        ARRAY [392,3719]
                            OBJECT [393,452]
                                FIELD [394,422]
                                    String: "name" [394,400]
                                    STRING [401,422]
                                        String: "Checkout repository" [401,422]
                                FIELD [423,451]
                                    String: "uses" [423,429]
                                    STRING [430,451]
                                        String: "actions/checkout@v2" [430,451]
                            OBJECT [453,729]
                                FIELD [454,499]
                                    String: "name" [454,460]
                                    STRING [461,499]
                                        String: "Set CHANNEL (only for tagged pushes)" [461,499]
                                FIELD [500,587]
                                    String: "if" [500,504]
                                    STRING [505,587]
                                        String: "${{ github.event_name == 'push' && startsWith(github.event.ref, 'refs/tags/') }}" [505,587]
                                FIELD [588,728]
                                    String: "run" [588,593]
                                    STRING [594,728]
                                        String: "# reference ends with an RC suffix\nif [[ ${GITHUB_REF_NAME} = *-rc[0-9]* ]]; then\n  echo \"CHANNEL=test\" >> \"$GITHUB_ENV\"\nfi\n" [594,728]
                            OBJECT [730,967]
                                FIELD [731,773]
                                    String: "name" [731,737]
                                    STRING [738,773]
                                        String: "Set Release CHANNEL (for release)" [738,773]
                                FIELD [774,915]
                                    String: "if" [774,778]
                                    STRING [779,915]
                                        String: "${{ (github.event_name == 'pull_request' && startsWith(github.base_ref, 'release')) || startsWith(github.ref, 'refs/heads/release') }}" [779,915]
                                FIELD [916,966]
                                    String: "run" [916,921]
                                    STRING [922,966]
                                        String: "echo \"CHANNEL=test\" >> \"$GITHUB_ENV\"\n" [922,966]
                            OBJECT [968,2104]
                                FIELD [969,1004]
                                    String: "name" [969,975]
                                    STRING [976,1004]
                                        String: "Build TorchVision M1 wheel" [976,1004]
                                FIELD [1005,1040]
                                    String: "shell" [1005,1012]
                                    STRING [1013,1040]
                                        String: "arch -arch arm64 bash {0}" [1013,1040]
                                FIELD [1041,1126]
                                    String: "env" [1041,1046]
                                    OBJECT [1047,1126]
                                        FIELD [1048,1091]
                                            String: "ENV_NAME" [1048,1058]
                                            STRING [1059,1091]
                                                String: "conda-env-${{ github.run_id }}" [1059,1091]
                                        FIELD [1092,1125]
                                            String: "PY_VERS" [1092,1101]
                                            STRING [1102,1125]
                                                String: "${{ matrix.py_vers }}" [1102,1125]
                                FIELD [1127,2103]
                                    String: "run" [1127,1132]
                                    STRING [1133,2103]
                                        String: "# Needed for JPEG library detection as setup.py detects conda presence by running `shutil.which('conda')`\nset -ex\n. packaging/pkg_helpers.bash\n# if we are uploading to test channell, our version consist only of the base: 0.x.x - no date string or suffix added\nif [[ $CHANNEL == \"test\" ]]; then\n  setup_base_build_version\nelse\n  setup_build_version\nfi\n\nconda create -yp ${ENV_NAME} python=${PY_VERS} numpy libpng jpeg wheel pkg-config\nconda run -p ${ENV_NAME} python3 -mpip install torch --pre --extra-index-url=https://download.pytorch.org/whl/${CHANNEL}\nconda run -p ${ENV_NAME} python3 -mpip install delocate\nconda run -p ${ENV_NAME} python3 setup.py bdist_wheel\nexport PYTORCH_VERSION=\"$(conda run -p ${ENV_NAME} python3 -mpip show torch | grep ^Version: | sed 's/Version:  *//')\"\nconda run -p ${ENV_NAME} DYLD_FALLBACK_LIBRARY_PATH=\"${ENV_NAME}/lib\" delocate-wheel -v --ignore-missing-dependencies dist/*.whl\nconda env remove -p ${ENV_NAME}\n" [1133,2103]
                            OBJECT [2105,3093]
                                FIELD [2106,2125]
                                    String: "name" [2106,2112]
                                    STRING [2113,2125]
                                        String: "Test wheel" [2113,2125]
                                FIELD [2126,2161]
                                    String: "shell" [2126,2133]
                                    STRING [2134,2161]
                                        String: "arch -arch arm64 bash {0}" [2134,2161]
                                FIELD [2162,2252]
                                    String: "env" [2162,2167]
                                    OBJECT [2168,2252]
                                        FIELD [2169,2217]
                                            String: "ENV_NAME" [2169,2179]
                                            STRING [2180,2217]
                                                String: "conda-test-env-${{ github.run_id }}" [2180,2217]
                                        FIELD [2218,2251]
                                            String: "PY_VERS" [2218,2227]
                                            STRING [2228,2251]
                                                String: "${{ matrix.py_vers }}" [2228,2251]
                                FIELD [2253,3092]
                                    String: "run" [2253,2258]
                                    STRING [2259,3092]
                                        String: "set -ex\nconda create -yp ${ENV_NAME} python=${PY_VERS} numpy\nconda run -p ${ENV_NAME} python3 -mpip install torch --pre --extra-index-url=https://download.pytorch.org/whl/${CHANNEL}\nconda run -p ${ENV_NAME} python3 -mpip install dist/*.whl\n# Test torch is importable, by changing cwd and running import commands\nconda run --cwd /tmp -p ${ENV_NAME} python3 -c \"import torchvision;print('torchvision version is ', torchvision.__version__)\"\nconda run --cwd /tmp -p ${ENV_NAME} python3 -c \"import torch;import torchvision;print('Is torchvision useable?', all(x is not None for x in [torch.ops.image.decode_png, torch.ops.torchvision.roi_align]))\"\nconda run --cwd /tmp -p ${ENV_NAME} python3 -c \"import torchvision;print(torchvision.io.read_image('${PWD}/gallery/assets/dog1.jpg').shape)\"\nconda env remove -p ${ENV_NAME}\n" [2259,3092]
                            OBJECT [3094,3243]
                                FIELD [3095,3126]
                                    String: "name" [3095,3101]
                                    STRING [3102,3126]
                                        String: "Upload wheel to GitHub" [3102,3126]
                                FIELD [3127,3162]
                                    String: "uses" [3127,3133]
                                    STRING [3134,3162]
                                        String: "actions/upload-artifact@v3" [3134,3162]
                                FIELD [3163,3242]
                                    String: "with" [3163,3169]
                                    OBJECT [3170,3242]
                                        FIELD [3171,3226]
                                            String: "name" [3171,3177]
                                            STRING [3178,3226]
                                                String: "torchvision-py${{ matrix.py_vers }}-macos11-m1" [3178,3226]
                                        FIELD [3227,3241]
                                            String: "path" [3227,3233]
                                            STRING [3234,3241]
                                                String: "dist/" [3234,3241]
                            OBJECT [3244,3718]
                                FIELD [3245,3272]
                                    String: "name" [3245,3251]
                                    STRING [3252,3272]
                                        String: "Upload wheel to S3" [3252,3272]
                                FIELD [3273,3406]
                                    String: "if" [3273,3277]
                                    STRING [3278,3406]
                                        String: "${{ github.event_name == 'push' && (github.event.ref == 'refs/heads/nightly' || startsWith(github.event.ref, 'refs/tags/')) }}" [3278,3406]
                                FIELD [3407,3442]
                                    String: "shell" [3407,3414]
                                    STRING [3415,3442]
                                        String: "arch -arch arm64 bash {0}" [3415,3442]
                                FIELD [3443,3602]
                                    String: "env" [3443,3448]
                                    OBJECT [3449,3602]
                                        FIELD [3450,3521]
                                            String: "AWS_ACCESS_KEY_ID" [3450,3469]
                                            STRING [3470,3521]
                                                String: "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}" [3470,3521]
                                        FIELD [3522,3601]
                                            String: "AWS_SECRET_ACCESS_KEY" [3522,3545]
                                            STRING [3546,3601]
                                                String: "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}" [3546,3601]
                                FIELD [3603,3717]
                                    String: "run" [3603,3608]
                                    STRING [3609,3717]
                                        String: "for pkg in dist/*; do\n  aws s3 cp \"$pkg\" \"s3://pytorch/whl/${CHANNEL}/cpu/\" --acl public-read\ndone\n" [3609,3717]
            FIELD [3721,5862]
                String: "build_conda" [3721,3734]
                OBJECT [3735,5862]
                    FIELD [3736,3780]
                        String: "name" [3736,3742]
                        STRING [3743,3780]
                            String: "Build TorchVision M1 conda packages" [3743,3780]
                    FIELD [3781,3804]
                        String: "runs-on" [3781,3790]
                        STRING [3791,3804]
                            String: "macos-m1-12" [3791,3804]
                    FIELD [3805,3859]
                        String: "strategy" [3805,3815]
                        OBJECT [3816,3859]
                            FIELD [3817,3858]
                                String: "matrix" [3817,3825]
                                OBJECT [3826,3858]
                                    FIELD [3827,3857]
                                        String: "py_vers" [3827,3836]
                                        ARRAY [3837,3857]
                                            STRING [3838,3843]
                                                String: "3.8" [3838,3843]
                                            STRING [3844,3849]
                                                String: "3.9" [3844,3849]
                                            STRING [3850,3856]
                                                String: "3.10" [3850,3856]
                    FIELD [3860,5861]
                        String: "steps" [3860,3867]
                        ARRAY [3868,5861]
                            OBJECT [3869,3928]
                                FIELD [3870,3898]
                                    String: "name" [3870,3876]
                                    STRING [3877,3898]
                                        String: "Checkout repository" [3877,3898]
                                FIELD [3899,3927]
                                    String: "uses" [3899,3905]
                                    STRING [3906,3927]
                                        String: "actions/checkout@v2" [3906,3927]
                            OBJECT [3929,4205]
                                FIELD [3930,3975]
                                    String: "name" [3930,3936]
                                    STRING [3937,3975]
                                        String: "Set CHANNEL (only for tagged pushes)" [3937,3975]
                                FIELD [3976,4063]
                                    String: "if" [3976,3980]
                                    STRING [3981,4063]
                                        String: "${{ github.event_name == 'push' && startsWith(github.event.ref, 'refs/tags/') }}" [3981,4063]
                                FIELD [4064,4204]
                                    String: "run" [4064,4069]
                                    STRING [4070,4204]
                                        String: "# reference ends with an RC suffix\nif [[ ${GITHUB_REF_NAME} = *-rc[0-9]* ]]; then\n  echo \"CHANNEL=test\" >> \"$GITHUB_ENV\"\nfi\n" [4070,4204]
                            OBJECT [4206,4443]
                                FIELD [4207,4249]
                                    String: "name" [4207,4213]
                                    STRING [4214,4249]
                                        String: "Set CHANNEL Release (for release)" [4214,4249]
                                FIELD [4250,4391]
                                    String: "if" [4250,4254]
                                    STRING [4255,4391]
                                        String: "${{ (github.event_name == 'pull_request' && startsWith(github.base_ref, 'release')) || startsWith(github.ref, 'refs/heads/release') }}" [4255,4391]
                                FIELD [4392,4442]
                                    String: "run" [4392,4397]
                                    STRING [4398,4442]
                                        String: "echo \"CHANNEL=test\" >> \"$GITHUB_ENV\"\n" [4398,4442]
                            OBJECT [4444,4602]
                                FIELD [4445,4502]
                                    String: "name" [4445,4451]
                                    STRING [4452,4502]
                                        String: "Install conda-build and purge previous artifacts" [4452,4502]
                                FIELD [4503,4538]
                                    String: "shell" [4503,4510]
                                    STRING [4511,4538]
                                        String: "arch -arch arm64 bash {0}" [4511,4538]
                                FIELD [4539,4601]
                                    String: "run" [4539,4544]
                                    STRING [4545,4601]
                                        String: "conda install -yq conda-build\nconda build purge-all\n" [4545,4601]
                            OBJECT [4603,5185]
                                FIELD [4604,4647]
                                    String: "name" [4604,4610]
                                    STRING [4611,4647]
                                        String: "Build TorchVision M1 conda package" [4611,4647]
                                FIELD [4648,4683]
                                    String: "shell" [4648,4655]
                                    STRING [4656,4683]
                                        String: "arch -arch arm64 bash {0}" [4656,4683]
                                FIELD [4684,4795]
                                    String: "env" [4684,4689]
                                    OBJECT [4690,4795]
                                        FIELD [4691,4734]
                                            String: "ENV_NAME" [4691,4701]
                                            STRING [4702,4734]
                                                String: "conda-env-${{ github.run_id }}" [4702,4734]
                                        FIELD [4735,4775]
                                            String: "PYTHON_VERSION" [4735,4751]
                                            STRING [4752,4775]
                                                String: "${{ matrix.py_vers }}" [4752,4775]
                                        FIELD [4776,4794]
                                            String: "CU_VERSION" [4776,4788]
                                            STRING [4789,4794]
                                                String: "cpu" [4789,4794]
                                FIELD [4796,5184]
                                    String: "run" [4796,4801]
                                    STRING [4802,5184]
                                        String: "set -ex\n. packaging/pkg_helpers.bash\n\nif [[ $CHANNEL == \"test\" ]]; then\n  setup_base_build_version\nelse\n  setup_build_version\nfi\n\nsetup_conda_pytorch_constraint\nexport SOURCE_ROOT_DIR=$(pwd)\nconda build \\\n  -c defaults \\\n  $CONDA_CHANNEL_FLAGS \\\n  --no-anaconda-upload \\\n  --python \"$PYTHON_VERSION\" \\\n  --output-folder=dist/ \\\n  packaging/torchvision\n" [4802,5184]
                            OBJECT [5186,5343]
                                FIELD [5187,5220]
                                    String: "name" [5187,5193]
                                    STRING [5194,5220]
                                        String: "Upload package to GitHub" [5194,5220]
                                FIELD [5221,5256]
                                    String: "uses" [5221,5227]
                                    STRING [5228,5256]
                                        String: "actions/upload-artifact@v3" [5228,5256]
                                FIELD [5257,5342]
                                    String: "with" [5257,5263]
                                    OBJECT [5264,5342]
                                        FIELD [5265,5326]
                                            String: "name" [5265,5271]
                                            STRING [5272,5326]
                                                String: "torchvision-py${{ matrix.py_vers }}-macos11-m1-conda" [5272,5326]
                                        FIELD [5327,5341]
                                            String: "path" [5327,5333]
                                            STRING [5334,5341]
                                                String: "dist/" [5334,5341]
                            OBJECT [5344,5860]
                                FIELD [5345,5377]
                                    String: "name" [5345,5351]
                                    STRING [5352,5377]
                                        String: "Upload package to conda" [5352,5377]
                                FIELD [5378,5511]
                                    String: "if" [5378,5382]
                                    STRING [5383,5511]
                                        String: "${{ github.event_name == 'push' && (github.event.ref == 'refs/heads/nightly' || startsWith(github.event.ref, 'refs/tags/')) }}" [5383,5511]
                                FIELD [5512,5547]
                                    String: "shell" [5512,5519]
                                    STRING [5520,5547]
                                        String: "arch -arch arm64 bash {0}" [5520,5547]
                                FIELD [5548,5620]
                                    String: "env" [5548,5553]
                                    OBJECT [5554,5620]
                                        FIELD [5555,5619]
                                            String: "CONDA_PYTORCHBOT_TOKEN" [5555,5579]
                                            STRING [5580,5619]
                                                String: "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}" [5580,5619]
                                FIELD [5621,5859]
                                    String: "run" [5621,5626]
                                    STRING [5627,5859]
                                        String: "conda install -yq anaconda-client\nset -x\nexport ANACONDA_PATH=$(conda info --base)/bin\n$ANACONDA_PATH/anaconda  -t \"${CONDA_PYTORCHBOT_TOKEN}\" upload dist/*.tar.bz2 -u \"pytorch-${CHANNEL}\" --label main --no-progress --force" [5627,5859]