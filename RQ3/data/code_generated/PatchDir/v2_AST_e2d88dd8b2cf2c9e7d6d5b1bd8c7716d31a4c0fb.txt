OBJECT [0,4358]
    FIELD [1,36]
        String: "name" [1,7]
        STRING [8,36]
            String: "Pin: Downstream: 2nd party" [8,36]
    FIELD [37,153]
        String: "on" [37,41]
        OBJECT [42,153]
            FIELD [43,123]
                String: "pull_request" [43,57]
                OBJECT [58,123]
                    FIELD [59,102]
                        String: "types" [59,66]
                        ARRAY [67,102]
                            STRING [68,76]
                                String: "opened" [68,76]
                            STRING [77,90]
                                String: "synchronize" [77,90]
                            STRING [91,101]
                                String: "reopened" [91,101]
                    FIELD [103,122]
                        String: "branches" [103,113]
                        ARRAY [114,122]
                            STRING [115,121]
                                String: "main" [115,121]
            FIELD [124,152]
                String: "push" [124,130]
                OBJECT [131,152]
                    FIELD [132,151]
                        String: "branches" [132,142]
                        ARRAY [143,151]
                            STRING [144,150]
                                String: "main" [144,150]
    FIELD [154,4357]
        String: "jobs" [154,160]
        OBJECT [161,4357]
            FIELD [162,1590]
                String: "manifest" [162,172]
                OBJECT [173,1590]
                    FIELD [174,199]
                        String: "runs-on" [174,183]
                        STRING [184,199]
                            String: "ubuntu-latest" [184,199]
                    FIELD [200,358]
                        String: "outputs" [200,209]
                        OBJECT [210,358]
                            FIELD [211,274]
                                String: "length" [211,219]
                                STRING [220,274]
                                    String: "${{ steps.create-manifest-instance.outputs.length }}" [220,274]
                            FIELD [275,357]
                                String: "manifest" [275,285]
                                STRING [286,357]
                                    String: "${{ steps.create-manifest-instance.outputs.github_actions_manifest }}" [286,357]
                    FIELD [359,1589]
                        String: "steps" [359,366]
                        ARRAY [367,1589]
                            OBJECT [368,458]
                                FIELD [369,391]
                                    String: "name" [369,375]
                                    STRING [376,391]
                                        String: "Set up Python" [376,391]
                                FIELD [392,424]
                                    String: "uses" [392,398]
                                    STRING [399,424]
                                        String: "actions/setup-python@v4" [399,424]
                                FIELD [425,457]
                                    String: "with" [425,431]
                                    OBJECT [432,457]
                                        FIELD [433,456]
                                            String: "python-version" [433,449]
                                            STRING [450,456]
                                                String: "3.11" [450,456]
                            OBJECT [459,489]
                                FIELD [460,488]
                                    String: "uses" [460,466]
                                    STRING [467,488]
                                        String: "actions/checkout@v3" [467,488]
                            OBJECT [490,1588]
                                FIELD [491,532]
                                    String: "name" [491,497]
                                    STRING [498,532]
                                        String: "Build manifest from plugins.json" [498,532]
                                FIELD [533,564]
                                    String: "id" [533,537]
                                    STRING [538,564]
                                        String: "create-manifest-instance" [538,564]
                                FIELD [565,664]
                                    String: "env" [565,570]
                                    OBJECT [571,664]
                                        FIELD [572,607]
                                            String: "PLUGINS_JSON" [572,586]
                                            STRING [587,607]
                                                String: "dffml/plugins.json" [587,607]
                                        FIELD [608,642]
                                            String: "SCHEMA" [608,616]
                                            STRING [617,642]
                                                String: "TODO-dffml-2ndparty-pin" [617,642]
                                        FIELD [643,663]
                                            String: "JSON_INDENT" [643,656]
                                            STRING [657,663]
                                                String: "    " [657,663]
                                FIELD [665,688]
                                    String: "shell" [665,672]
                                    STRING [673,688]
                                        String: "python -u {0}" [673,688]
                                FIELD [689,1587]
                                    String: "run" [689,694]
                                    STRING [695,1587]
                                        String: "import os\nimport json\n\nplugins = json.loads(pathlib.Path(os.environ[\"PLUGINS_JSON\"]).read_text())\nmanifest = plugins[\"plugins\"][\"parties\"][\"2nd\"]\n\ngithub_actions_manifest = {\n    \"include\": manifest,\n}\njson_ld_manifest = {\n    \"@context\": {\n        \"@vocab\": os.environ[\"SCHEMA\"],\n    },\n    **github_actions_manifest,\n}\nprint(json.dumps(json_ld_manifest, sort_keys=True, indent=os.environ.get(\"JSON_INDENT\", None)))\n\nif \"GITHUB_OUTPUT\" in os.environ:\n    with open(os.environ[\"GITHUB_OUTPUT\"], \"a\") as fileobj:\n        fileobj.write(f'length={len(manifest)}\\n')\n        fileobj.write(f\"manifest={json.dumps(manifest, sort_keys=True)}\\n\")\n        fileobj.write(f'github_actions_manifest={json.dumps(github_actions_manifest, sort_keys=True)}\\n')\n        fileobj.write(f'json_ld_manifest={json.dumps(json_ld_manifest, sort_keys=True)}\\n')\n" [695,1587]
            FIELD [1591,4356]
                String: "pin_downstream_pep_440" [1591,1615]
                OBJECT [1616,4356]
                    FIELD [1617,1657]
                        String: "name" [1617,1623]
                        STRING [1624,1657]
                            String: "Pin downstream to latest commit" [1624,1657]
                    FIELD [1658,1683]
                        String: "runs-on" [1658,1667]
                        STRING [1668,1683]
                            String: "ubuntu-latest" [1668,1683]
                    FIELD [1684,2007]
                        String: "env" [1684,1689]
                        OBJECT [1690,2007]
                            FIELD [1691,1747]
                                String: "PIN_PULL_REQUEST_EMAIL" [1691,1715]
                                STRING [1716,1747]
                                    String: "alice.omega.alpha@outlook.com" [1716,1747]
                            FIELD [1748,1787]
                                String: "PIN_PULL_REQUEST_NAME" [1748,1771]
                                STRING [1772,1787]
                                    String: "Alice Alchemy" [1772,1787]
                            FIELD [1788,1863]
                                String: "GH_ACCESS_TOKEN" [1788,1805]
                                STRING [1806,1863]
                                    String: "${{ secrets.PIN_DOWNSTREAM_2ND_PARTY_GH_ACCESS_TOKEN }}" [1806,1863]
                            FIELD [1864,1945]
                                String: "PIN_TO_COMMIT" [1864,1879]
                                STRING [1880,1945]
                                    String: "${{ github.event.after || github.event.pull_request.head.sha }}" [1880,1945]
                            FIELD [1946,2006]
                                String: "BUMP_DEP" [1946,1956]
                                STRING [1957,2006]
                                    String: "dffml @ https://github.com/intel/dffml/archive/" [1957,2006]
                    FIELD [2008,2028]
                        String: "needs" [2008,2015]
                        ARRAY [2016,2028]
                            STRING [2017,2027]
                                String: "manifest" [2017,2027]
                    FIELD [2029,2138]
                        String: "strategy" [2029,2039]
                        OBJECT [2040,2138]
                            FIELD [2041,2058]
                                String: "fail-fast" [2041,2052]
                                FALSE [2053,2058]
                            FIELD [2059,2077]
                                String: "max-parallel" [2059,2073]
                                NUMBER [2074,2077]
                                    Number: 100 [2074,2077]
                            FIELD [2078,2137]
                                String: "matrix" [2078,2086]
                                STRING [2087,2137]
                                    String: "${{ fromJSON(needs.manifest.outputs.manifest) }}" [2087,2137]
                    FIELD [2139,4355]
                        String: "steps" [2139,2146]
                        ARRAY [2147,4355]
                            OBJECT [2148,2508]
                                FIELD [2149,2166]
                                    String: "name" [2149,2155]
                                    STRING [2156,2166]
                                        String: "Checkout" [2156,2166]
                                FIELD [2167,2297]
                                    String: "env" [2167,2172]
                                    OBJECT [2173,2297]
                                        FIELD [2174,2218]
                                            String: "TARGET_REPO_URL" [2174,2191]
                                            STRING [2192,2218]
                                                String: "${{ matrix.source_url }}" [2192,2218]
                                        FIELD [2219,2257]
                                            String: "TARGET_BRANCH" [2219,2234]
                                            STRING [2235,2257]
                                                String: "${{ matrix.branch }}" [2235,2257]
                                        FIELD [2258,2296]
                                            String: "TARGET_COMMIT" [2258,2273]
                                            STRING [2274,2296]
                                                String: "${{ matrix.branch }}" [2274,2296]
                                FIELD [2298,2507]
                                    String: "run" [2298,2303]
                                    STRING [2304,2507]
                                        String: "set -x\ngit init\ngit remote add origin \"${TARGET_REPO_URL}\"\ngit fetch origin \"${TARGET_BRANCH}\" --depth 1\ngit fetch origin \"${TARGET_COMMIT}\" --depth 1\ngit reset --hard \"${TARGET_COMMIT}\"\n" [2304,2507]
                            OBJECT [2509,2797]
                                FIELD [2510,2550]
                                    String: "name" [2510,2516]
                                    STRING [2517,2550]
                                        String: "Find repo local dependent files" [2517,2550]
                                FIELD [2551,2579]
                                    String: "id" [2551,2555]
                                    STRING [2556,2579]
                                        String: "repo-local-downstream" [2556,2579]
                                FIELD [2580,2796]
                                    String: "run" [2580,2585]
                                    STRING [2586,2796]
                                        String: "set -x\nget_files() {\n  git grep \"${BUMP_DEP}\" | sed -e 's/:.*//g' | sort | uniq\n}\necho files_length=$(get_files | wc -l) >> $GITHUB_OUTPUT\necho files=$(get_files | jq -R | jq -s -c) >> $GITHUB_OUTPUT\n" [2586,2796]
                            OBJECT [2798,4354]
                                FIELD [2799,2852]
                                    String: "name" [2799,2805]
                                    STRING [2806,2852]
                                        String: "Update pinning of upstream within downstream" [2806,2852]
                                FIELD [2853,2929]
                                    String: "if" [2853,2857]
                                    STRING [2858,2929]
                                        String: "${{ fromJSON(steps.repo-local-downstream.outputs.files_length) > 0 }}" [2858,2929]
                                FIELD [2930,2956]
                                    String: "id" [2930,2934]
                                    STRING [2935,2956]
                                        String: "create-pull-request" [2935,2956]
                                FIELD [2957,3487]
                                    String: "env" [2957,2962]
                                    OBJECT [2963,3487]
                                        FIELD [2964,3001]
                                            String: "NEW_HASH" [2964,2974]
                                            STRING [2975,3001]
                                                String: "${{ env.PIN_TO_COMMIT }}" [2975,3001]
                                        FIELD [3002,3303]
                                            String: "COMMIT_MESSAGE" [3002,3018]
                                            STRING [3019,3303]
                                                String: "setup: Pin ${{ env.UPSTREAM_PACKAGE_NAME }} to ${{ env.PIN_TO_COMMIT }}\n${{ github.event.pull_request.html_url }}\n${{ github.server_url }}/${{ github.repository }}/commit/${{ env.PIN_TO_COMMIT }}\n${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}" [3019,3303]
                                        FIELD [3304,3389]
                                            String: "NEW_BRANCH_WITH_PIN" [3304,3325]
                                            STRING [3326,3389]
                                                String: "pin/pep_440/${{ github.repository }}/${{ env.PIN_TO_COMMIT }}" [3326,3389]
                                        FIELD [3390,3456]
                                            String: "FILES" [3390,3397]
                                            STRING [3398,3456]
                                                String: "${{ toJSON(steps.repo-local-downstream.outputs.files) }}" [3398,3456]
                                        FIELD [3457,3486]
                                            String: "BASE" [3457,3463]
                                            STRING [3464,3486]
                                                String: "${{ matrix.branch }}" [3464,3486]
                                FIELD [3488,4353]
                                    String: "run" [3488,3493]
                                    STRING [3494,4353]
                                        String: "set -x\n# https://github.com/dffml/dffml-model-transformers/blob/898af4a51d9b5d70d58ce80ba2c508f3afa82400/setup.cfg#L6\nsed -i -r -e \"s#${BUMP_DEP}[A-Fa-f0-9]{40}#${BUMP_DEP}${NEW_HASH}#g\" $(echo \"${FILES}\" | jq -r '.[]')\ngit checkout -b \"${NEW_BRANCH_WITH_PIN}\"\ngit config user.email \"${PIN_PULL_REQUEST_EMAIL}\"\ngit config user.name \"${PIN_PULL_REQUEST_NAME}\"\ngit commit -sam \"${COMMIT_MESSAGE}\"\necho \"${GH_ACCESS_TOKEN}\" | gh auth login --with-token\ngit push -u origin -f \"${NEW_BRANCH_WITH_PIN}\"\ngh pr create --base \"${BASE}\" --head \"${NEW_BRANCH_WITH_PIN}\" --title \"${COMMIT_MESSAGE}\" --body \"\" | tee pull-request-url\nPULL_REQUEST_URL=\"$(cat pull-request-url)\"\nif [[ \"x${PULL_REQUEST_URL}\" == \"x\" ]]; then\n  echo \"No pull request URL\" 1>&2\n  exit 1\nfi\necho \"url=${PULL_REQUEST_URL}\" | tee -a $GITHUB_OUTPUT" [3494,4353]