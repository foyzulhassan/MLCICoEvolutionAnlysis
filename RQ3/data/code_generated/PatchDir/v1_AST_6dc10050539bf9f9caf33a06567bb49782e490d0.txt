OBJECT [0,4329]
    FIELD [1,36]
        String: "name" [1,7]
        STRING [8,36]
            String: "Pin: Downstream: 2nd party" [8,36]
    FIELD [37,124]
        String: "on" [37,41]
        OBJECT [42,124]
            FIELD [43,123]
                String: "pull_request" [43,57]
                OBJECT [58,123]
                    FIELD [59,102]
                        String: "types" [59,66]
                        ARRAY [67,102]
                            STRING [68,76]
                                String: "opened" [68,76]
                            STRING [77,90]
                                String: "synchronize" [77,90]
                            STRING [91,101]
                                String: "reopened" [91,101]
                    FIELD [103,122]
                        String: "branches" [103,113]
                        ARRAY [114,122]
                            STRING [115,121]
                                String: "main" [115,121]
    FIELD [125,4328]
        String: "jobs" [125,131]
        OBJECT [132,4328]
            FIELD [133,1561]
                String: "manifest" [133,143]
                OBJECT [144,1561]
                    FIELD [145,170]
                        String: "runs-on" [145,154]
                        STRING [155,170]
                            String: "ubuntu-latest" [155,170]
                    FIELD [171,329]
                        String: "outputs" [171,180]
                        OBJECT [181,329]
                            FIELD [182,245]
                                String: "length" [182,190]
                                STRING [191,245]
                                    String: "${{ steps.create-manifest-instance.outputs.length }}" [191,245]
                            FIELD [246,328]
                                String: "manifest" [246,256]
                                STRING [257,328]
                                    String: "${{ steps.create-manifest-instance.outputs.github_actions_manifest }}" [257,328]
                    FIELD [330,1560]
                        String: "steps" [330,337]
                        ARRAY [338,1560]
                            OBJECT [339,429]
                                FIELD [340,362]
                                    String: "name" [340,346]
                                    STRING [347,362]
                                        String: "Set up Python" [347,362]
                                FIELD [363,395]
                                    String: "uses" [363,369]
                                    STRING [370,395]
                                        String: "actions/setup-python@v4" [370,395]
                                FIELD [396,428]
                                    String: "with" [396,402]
                                    OBJECT [403,428]
                                        FIELD [404,427]
                                            String: "python-version" [404,420]
                                            STRING [421,427]
                                                String: "3.11" [421,427]
                            OBJECT [430,460]
                                FIELD [431,459]
                                    String: "uses" [431,437]
                                    STRING [438,459]
                                        String: "actions/checkout@v3" [438,459]
                            OBJECT [461,1559]
                                FIELD [462,503]
                                    String: "name" [462,468]
                                    STRING [469,503]
                                        String: "Build manifest from plugins.json" [469,503]
                                FIELD [504,535]
                                    String: "id" [504,508]
                                    STRING [509,535]
                                        String: "create-manifest-instance" [509,535]
                                FIELD [536,635]
                                    String: "env" [536,541]
                                    OBJECT [542,635]
                                        FIELD [543,578]
                                            String: "PLUGINS_JSON" [543,557]
                                            STRING [558,578]
                                                String: "dffml/plugins.json" [558,578]
                                        FIELD [579,613]
                                            String: "SCHEMA" [579,587]
                                            STRING [588,613]
                                                String: "TODO-dffml-2ndparty-pin" [588,613]
                                        FIELD [614,634]
                                            String: "JSON_INDENT" [614,627]
                                            STRING [628,634]
                                                String: "    " [628,634]
                                FIELD [636,659]
                                    String: "shell" [636,643]
                                    STRING [644,659]
                                        String: "python -u {0}" [644,659]
                                FIELD [660,1558]
                                    String: "run" [660,665]
                                    STRING [666,1558]
                                        String: "import os\nimport json\n\nplugins = json.loads(pathlib.Path(os.environ[\"PLUGINS_JSON\"]).read_text())\nmanifest = plugins[\"plugins\"][\"parties\"][\"2nd\"]\n\ngithub_actions_manifest = {\n    \"include\": manifest,\n}\njson_ld_manifest = {\n    \"@context\": {\n        \"@vocab\": os.environ[\"SCHEMA\"],\n    },\n    **github_actions_manifest,\n}\nprint(json.dumps(json_ld_manifest, sort_keys=True, indent=os.environ.get(\"JSON_INDENT\", None)))\n\nif \"GITHUB_OUTPUT\" in os.environ:\n    with open(os.environ[\"GITHUB_OUTPUT\"], \"a\") as fileobj:\n        fileobj.write(f'length={len(manifest)}\\n')\n        fileobj.write(f\"manifest={json.dumps(manifest, sort_keys=True)}\\n\")\n        fileobj.write(f'github_actions_manifest={json.dumps(github_actions_manifest, sort_keys=True)}\\n')\n        fileobj.write(f'json_ld_manifest={json.dumps(json_ld_manifest, sort_keys=True)}\\n')\n" [666,1558]
            FIELD [1562,4327]
                String: "pin_downstream_pep_440" [1562,1586]
                OBJECT [1587,4327]
                    FIELD [1588,1628]
                        String: "name" [1588,1594]
                        STRING [1595,1628]
                            String: "Pin downstream to latest commit" [1595,1628]
                    FIELD [1629,1654]
                        String: "runs-on" [1629,1638]
                        STRING [1639,1654]
                            String: "ubuntu-latest" [1639,1654]
                    FIELD [1655,1978]
                        String: "env" [1655,1660]
                        OBJECT [1661,1978]
                            FIELD [1662,1718]
                                String: "PIN_PULL_REQUEST_EMAIL" [1662,1686]
                                STRING [1687,1718]
                                    String: "alice.omega.alpha@outlook.com" [1687,1718]
                            FIELD [1719,1758]
                                String: "PIN_PULL_REQUEST_NAME" [1719,1742]
                                STRING [1743,1758]
                                    String: "Alice Alchemy" [1743,1758]
                            FIELD [1759,1834]
                                String: "GH_ACCESS_TOKEN" [1759,1776]
                                STRING [1777,1834]
                                    String: "${{ secrets.PIN_DOWNSTREAM_2ND_PARTY_GH_ACCESS_TOKEN }}" [1777,1834]
                            FIELD [1835,1916]
                                String: "PIN_TO_COMMIT" [1835,1850]
                                STRING [1851,1916]
                                    String: "${{ github.event.after || github.event.pull_request.head.sha }}" [1851,1916]
                            FIELD [1917,1977]
                                String: "BUMP_DEP" [1917,1927]
                                STRING [1928,1977]
                                    String: "dffml @ https://github.com/intel/dffml/archive/" [1928,1977]
                    FIELD [1979,1999]
                        String: "needs" [1979,1986]
                        ARRAY [1987,1999]
                            STRING [1988,1998]
                                String: "manifest" [1988,1998]
                    FIELD [2000,2109]
                        String: "strategy" [2000,2010]
                        OBJECT [2011,2109]
                            FIELD [2012,2029]
                                String: "fail-fast" [2012,2023]
                                FALSE [2024,2029]
                            FIELD [2030,2048]
                                String: "max-parallel" [2030,2044]
                                NUMBER [2045,2048]
                                    Number: 100 [2045,2048]
                            FIELD [2049,2108]
                                String: "matrix" [2049,2057]
                                STRING [2058,2108]
                                    String: "${{ fromJSON(needs.manifest.outputs.manifest) }}" [2058,2108]
                    FIELD [2110,4326]
                        String: "steps" [2110,2117]
                        ARRAY [2118,4326]
                            OBJECT [2119,2479]
                                FIELD [2120,2137]
                                    String: "name" [2120,2126]
                                    STRING [2127,2137]
                                        String: "Checkout" [2127,2137]
                                FIELD [2138,2268]
                                    String: "env" [2138,2143]
                                    OBJECT [2144,2268]
                                        FIELD [2145,2189]
                                            String: "TARGET_REPO_URL" [2145,2162]
                                            STRING [2163,2189]
                                                String: "${{ matrix.source_url }}" [2163,2189]
                                        FIELD [2190,2228]
                                            String: "TARGET_BRANCH" [2190,2205]
                                            STRING [2206,2228]
                                                String: "${{ matrix.branch }}" [2206,2228]
                                        FIELD [2229,2267]
                                            String: "TARGET_COMMIT" [2229,2244]
                                            STRING [2245,2267]
                                                String: "${{ matrix.branch }}" [2245,2267]
                                FIELD [2269,2478]
                                    String: "run" [2269,2274]
                                    STRING [2275,2478]
                                        String: "set -x\ngit init\ngit remote add origin \"${TARGET_REPO_URL}\"\ngit fetch origin \"${TARGET_BRANCH}\" --depth 1\ngit fetch origin \"${TARGET_COMMIT}\" --depth 1\ngit reset --hard \"${TARGET_COMMIT}\"\n" [2275,2478]
                            OBJECT [2480,2768]
                                FIELD [2481,2521]
                                    String: "name" [2481,2487]
                                    STRING [2488,2521]
                                        String: "Find repo local dependent files" [2488,2521]
                                FIELD [2522,2550]
                                    String: "id" [2522,2526]
                                    STRING [2527,2550]
                                        String: "repo-local-downstream" [2527,2550]
                                FIELD [2551,2767]
                                    String: "run" [2551,2556]
                                    STRING [2557,2767]
                                        String: "set -x\nget_files() {\n  git grep \"${BUMP_DEP}\" | sed -e 's/:.*//g' | sort | uniq\n}\necho files_length=$(get_files | wc -l) >> $GITHUB_OUTPUT\necho files=$(get_files | jq -R | jq -s -c) >> $GITHUB_OUTPUT\n" [2557,2767]
                            OBJECT [2769,4325]
                                FIELD [2770,2823]
                                    String: "name" [2770,2776]
                                    STRING [2777,2823]
                                        String: "Update pinning of upstream within downstream" [2777,2823]
                                FIELD [2824,2900]
                                    String: "if" [2824,2828]
                                    STRING [2829,2900]
                                        String: "${{ fromJSON(steps.repo-local-downstream.outputs.files_length) > 0 }}" [2829,2900]
                                FIELD [2901,2927]
                                    String: "id" [2901,2905]
                                    STRING [2906,2927]
                                        String: "create-pull-request" [2906,2927]
                                FIELD [2928,3458]
                                    String: "env" [2928,2933]
                                    OBJECT [2934,3458]
                                        FIELD [2935,2972]
                                            String: "NEW_HASH" [2935,2945]
                                            STRING [2946,2972]
                                                String: "${{ env.PIN_TO_COMMIT }}" [2946,2972]
                                        FIELD [2973,3274]
                                            String: "COMMIT_MESSAGE" [2973,2989]
                                            STRING [2990,3274]
                                                String: "setup: Pin ${{ env.UPSTREAM_PACKAGE_NAME }} to ${{ env.PIN_TO_COMMIT }}\n${{ github.event.pull_request.html_url }}\n${{ github.server_url }}/${{ github.repository }}/commit/${{ env.PIN_TO_COMMIT }}\n${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}" [2990,3274]
                                        FIELD [3275,3360]
                                            String: "NEW_BRANCH_WITH_PIN" [3275,3296]
                                            STRING [3297,3360]
                                                String: "pin/pep_440/${{ github.repository }}/${{ env.PIN_TO_COMMIT }}" [3297,3360]
                                        FIELD [3361,3427]
                                            String: "FILES" [3361,3368]
                                            STRING [3369,3427]
                                                String: "${{ toJSON(steps.repo-local-downstream.outputs.files) }}" [3369,3427]
                                        FIELD [3428,3457]
                                            String: "BASE" [3428,3434]
                                            STRING [3435,3457]
                                                String: "${{ matrix.branch }}" [3435,3457]
                                FIELD [3459,4324]
                                    String: "run" [3459,3464]
                                    STRING [3465,4324]
                                        String: "set -x\n# https://github.com/dffml/dffml-model-transformers/blob/898af4a51d9b5d70d58ce80ba2c508f3afa82400/setup.cfg#L6\nsed -i -r -e \"s#${BUMP_DEP}[A-Fa-f0-9]{40}#${BUMP_DEP}${NEW_HASH}#g\" $(echo \"${FILES}\" | jq -r '.[]')\ngit checkout -b \"${NEW_BRANCH_WITH_PIN}\"\ngit config user.email \"${PIN_PULL_REQUEST_EMAIL}\"\ngit config user.name \"${PIN_PULL_REQUEST_NAME}\"\ngit commit -sam \"${COMMIT_MESSAGE}\"\necho \"${GH_ACCESS_TOKEN}\" | gh auth login --with-token\ngit push -u origin -f \"${NEW_BRANCH_WITH_PIN}\"\ngh pr create --base \"${BASE}\" --head \"${NEW_BRANCH_WITH_PIN}\" --title \"${COMMIT_MESSAGE}\" --body \"\" | tee pull-request-url\nPULL_REQUEST_URL=\"$(cat pull-request-url)\"\nif [[ \"x${PULL_REQUEST_URL}\" == \"x\" ]]; then\n  echo \"No pull request URL\" 1>&2\n  exit 1\nfi\necho \"url=${PULL_REQUEST_URL}\" | tee -a $GITHUB_OUTPUT" [3465,4324]