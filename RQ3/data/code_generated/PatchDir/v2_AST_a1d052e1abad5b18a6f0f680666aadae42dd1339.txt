OBJECT [0,3240]
    FIELD [1,42]
        String: "name" [1,7]
        STRING [8,42]
            String: "DFFML: Build: Images: Containers" [8,42]
    FIELD [43,101]
        String: "on" [43,47]
        OBJECT [48,101]
            FIELD [49,100]
                String: "push" [49,55]
                OBJECT [56,100]
                    FIELD [57,76]
                        String: "branches" [57,67]
                        ARRAY [68,76]
                            STRING [69,75]
                                String: "main" [69,75]
                    FIELD [77,99]
                        String: "paths" [77,84]
                        ARRAY [85,99]
                            STRING [86,98]
                                String: "Dockerfile" [86,98]
    FIELD [102,3239]
        String: "jobs" [102,108]
        OBJECT [109,3239]
            FIELD [110,3038]
                String: "manifest" [110,120]
                OBJECT [121,3038]
                    FIELD [122,147]
                        String: "runs-on" [122,131]
                        STRING [132,147]
                            String: "ubuntu-latest" [132,147]
                    FIELD [148,227]
                        String: "outputs" [148,157]
                        OBJECT [158,227]
                            FIELD [159,226]
                                String: "manifest" [159,169]
                                STRING [170,226]
                                    String: "${{ steps.create-manifest-instance.outputs.manifest }}" [170,226]
                    FIELD [228,3037]
                        String: "steps" [228,235]
                        ARRAY [236,3037]
                            OBJECT [237,328]
                                FIELD [238,264]
                                    String: "name" [238,244]
                                    STRING [245,264]
                                        String: "Set up Python 3.9" [245,264]
                                FIELD [265,297]
                                    String: "uses" [265,271]
                                    STRING [272,297]
                                        String: "actions/setup-python@v2" [272,297]
                                FIELD [298,327]
                                    String: "with" [298,304]
                                    OBJECT [305,327]
                                        FIELD [306,326]
                                            String: "python-version" [306,322]
                                            NUMBER [323,326]
                                                Number: 3.9 [323,326]
                            OBJECT [329,359]
                                FIELD [330,358]
                                    String: "uses" [330,336]
                                    STRING [337,358]
                                        String: "actions/checkout@v3" [337,358]
                            OBJECT [360,3036]
                                FIELD [361,409]
                                    String: "name" [361,367]
                                    STRING [368,409]
                                        String: "Build manifest from changed dockerfiles" [368,409]
                                FIELD [410,441]
                                    String: "id" [410,414]
                                    STRING [415,441]
                                        String: "create-manifest-instance" [415,441]
                                FIELD [442,763]
                                    String: "env" [442,447]
                                    OBJECT [448,763]
                                        FIELD [449,460]
                                            String: "PREFIX" [449,457]
                                            STRING [458,460]
                                                String: "" [458,460]
                                        FIELD [461,476]
                                            String: "ROOT_PATH" [461,472]
                                            STRING [473,476]
                                                String: "." [473,476]
                                        FIELD [477,522]
                                            String: "OWNER_REPOSITORY" [477,495]
                                            STRING [496,522]
                                                String: "${{ github.repository }}" [496,522]
                                        FIELD [523,556]
                                            String: "BRANCH" [523,531]
                                            STRING [532,556]
                                                String: "${{ github.ref_name }}" [532,556]
                                        FIELD [557,615]
                                            String: "COMPARE_URL" [557,570]
                                            STRING [571,615]
                                                String: "${{ github.event.repository.compare_url }}" [571,615]
                                        FIELD [616,655]
                                            String: "GH_ACCESS_TOKEN" [616,633]
                                            STRING [634,655]
                                                String: "${{ github.token }}" [634,655]
                                        FIELD [656,690]
                                            String: "HEAD" [656,662]
                                            STRING [663,690]
                                                String: "${{ github.event.after }}" [663,690]
                                        FIELD [691,726]
                                            String: "BASE" [691,697]
                                            STRING [698,726]
                                                String: "${{ github.event.before }}" [698,726]
                                        FIELD [727,762]
                                            String: "BASE_REF" [727,737]
                                            STRING [738,762]
                                                String: "${{ github.base_ref }}" [738,762]
                                FIELD [764,787]
                                    String: "shell" [764,771]
                                    STRING [772,787]
                                        String: "python -u {0}" [772,787]
                                FIELD [788,3035]
                                    String: "run" [788,793]
                                    STRING [794,3035]
                                        String: "import os\nimport json\nimport pathlib\nimport urllib.request\nowner, repository = os.environ[\"OWNER_REPOSITORY\"].split(\"/\", maxsplit=1)\nbase = None\nenv_vars = [\"BASE\", \"BASE_REF\"]\nfor env_var in env_vars:\n    if env_var in os.environ and os.environ[env_var].strip():\n        # Set if present and not blank\n        base = os.environ[env_var]\nif base is None:\n    raise Exception(f\"None of {env_vars!r} found in os.environ\")\ncompare_url = os.environ[\"COMPARE_URL\"]\ncompare_url = compare_url.replace(\"{base}\", base)\ncompare_url = compare_url.replace(\"{head}\", os.environ[\"HEAD\"])\nwith urllib.request.urlopen(\n    urllib.request.Request(\n        compare_url,\n        headers={\n            \"Authorization\": \"bearer \" + os.environ[\"GH_ACCESS_TOKEN\"],\n        },\n    )\n) as response:\n    response_json = json.load(response)\n# Build the most recent commit\ncommit = response_json[\"commits\"][-1][\"sha\"]\n# Path to root of repo\nroot_path = pathlib.Path(os.environ[\"ROOT_PATH\"])\n# Must be a valid directory with .Dockerfiles in it\nprefix_path = pathlib.Path(os.environ[\"PREFIX\"])\nmanifest = list([\n    {\n        \"image_name\": pathlib.Path(compare_file[\"filename\"]).stem,\n        \"dockerfile\": compare_file[\"filename\"],\n        \"owner\": owner,\n        \"repository\": repository,\n        \"branch\": os.environ[\"BRANCH\"],\n        \"commit\": commit,\n    }\n    for compare_file in response_json[\"files\"]\n    if (\n        compare_file[\"filename\"].startswith(os.environ[\"PREFIX\"])\n        and compare_file[\"filename\"].endswith(\"Dockerfile\")\n    )\n])\n# Build everything if we aren't sure why we got here (alice changes or\n# workflow re-run)\nif not manifest:\n    manifest = list([\n        {\n            \"image_name\": path.stem,\n            \"dockerfile\": str(path.relative_to(root_path)),\n            \"owner\": owner,\n            \"repository\": repository,\n            \"branch\": os.environ[\"BRANCH\"],\n            \"commit\": commit,\n        }\n        for path in prefix_path.glob(\"*Dockerfile\")\n    ])\nprint(json.dumps(manifest, sort_keys=True, indent=4))\nprint(\"::set-output name=manifest::\" + json.dumps({\"include\": manifest}))\n" [794,3035]
            FIELD [3039,3238]
                String: "build" [3039,3046]
                OBJECT [3047,3238]
                    FIELD [3048,3066]
                        String: "needs" [3048,3055]
                        STRING [3056,3066]
                            String: "manifest" [3056,3066]
                    FIELD [3067,3123]
                        String: "uses" [3067,3073]
                        STRING [3074,3123]
                            String: "./.github/workflows/build_images_containers.yml" [3074,3123]
                    FIELD [3124,3185]
                        String: "with" [3124,3130]
                        OBJECT [3131,3185]
                            FIELD [3132,3184]
                                String: "manifests" [3132,3143]
                                STRING [3144,3184]
                                    String: "${{ needs.manifest.outputs.manifest }}" [3144,3184]
                    FIELD [3186,3237]
                        String: "secrets" [3186,3195]
                        OBJECT [3196,3237]
                            FIELD [3197,3236]
                                String: "GH_ACCESS_TOKEN" [3197,3214]
                                STRING [3215,3236]
                                    String: "${{ github.token }}" [3215,3236]