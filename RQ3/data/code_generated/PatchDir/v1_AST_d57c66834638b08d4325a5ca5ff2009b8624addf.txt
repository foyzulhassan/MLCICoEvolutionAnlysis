OBJECT [0,4700]
    FIELD [1,36]
        String: "name" [1,7]
        STRING [8,36]
            String: "Pin: Downstream: 2nd party" [8,36]
    FIELD [37,160]
        String: "on" [37,41]
        OBJECT [42,160]
            FIELD [43,130]
                String: "pull_request_target" [43,64]
                OBJECT [65,130]
                    FIELD [66,109]
                        String: "types" [66,73]
                        ARRAY [74,109]
                            STRING [75,83]
                                String: "opened" [75,83]
                            STRING [84,97]
                                String: "synchronize" [84,97]
                            STRING [98,108]
                                String: "reopened" [98,108]
                    FIELD [110,129]
                        String: "branches" [110,120]
                        ARRAY [121,129]
                            STRING [122,128]
                                String: "main" [122,128]
            FIELD [131,159]
                String: "push" [131,137]
                OBJECT [138,159]
                    FIELD [139,158]
                        String: "branches" [139,149]
                        ARRAY [150,158]
                            STRING [151,157]
                                String: "main" [151,157]
    FIELD [161,4699]
        String: "jobs" [161,167]
        OBJECT [168,4699]
            FIELD [169,1869]
                String: "manifest" [169,179]
                OBJECT [180,1869]
                    FIELD [181,206]
                        String: "runs-on" [181,190]
                        STRING [191,206]
                            String: "ubuntu-latest" [191,206]
                    FIELD [207,365]
                        String: "outputs" [207,216]
                        OBJECT [217,365]
                            FIELD [218,281]
                                String: "length" [218,226]
                                STRING [227,281]
                                    String: "${{ steps.create-manifest-instance.outputs.length }}" [227,281]
                            FIELD [282,364]
                                String: "manifest" [282,292]
                                STRING [293,364]
                                    String: "${{ steps.create-manifest-instance.outputs.github_actions_manifest }}" [293,364]
                    FIELD [366,1868]
                        String: "steps" [366,373]
                        ARRAY [374,1868]
                            OBJECT [375,465]
                                FIELD [376,398]
                                    String: "name" [376,382]
                                    STRING [383,398]
                                        String: "Set up Python" [383,398]
                                FIELD [399,431]
                                    String: "uses" [399,405]
                                    STRING [406,431]
                                        String: "actions/setup-python@v4" [406,431]
                                FIELD [432,464]
                                    String: "with" [432,438]
                                    OBJECT [439,464]
                                        FIELD [440,463]
                                            String: "python-version" [440,456]
                                            STRING [457,463]
                                                String: "3.11" [457,463]
                            OBJECT [466,496]
                                FIELD [467,495]
                                    String: "uses" [467,473]
                                    STRING [474,495]
                                        String: "actions/checkout@v3" [474,495]
                            OBJECT [497,1867]
                                FIELD [498,557]
                                    String: "name" [498,504]
                                    STRING [505,557]
                                        String: "Build manifest from plugins.json from pull request" [505,557]
                                FIELD [558,589]
                                    String: "id" [558,562]
                                    STRING [563,589]
                                        String: "create-manifest-instance" [563,589]
                                FIELD [590,689]
                                    String: "env" [590,595]
                                    OBJECT [596,689]
                                        FIELD [597,632]
                                            String: "PLUGINS_JSON" [597,611]
                                            STRING [612,632]
                                                String: "dffml/plugins.json" [612,632]
                                        FIELD [633,667]
                                            String: "SCHEMA" [633,641]
                                            STRING [642,667]
                                                String: "TODO-dffml-2ndparty-pin" [642,667]
                                        FIELD [668,688]
                                            String: "JSON_INDENT" [668,681]
                                            STRING [682,688]
                                                String: "    " [682,688]
                                FIELD [690,713]
                                    String: "shell" [690,697]
                                    STRING [698,713]
                                        String: "python -u {0}" [698,713]
                                FIELD [714,1866]
                                    String: "run" [714,719]
                                    STRING [720,1866]
                                        String: "import os\nimport json\nimport pathlib\n\nplugins = json.loads(pathlib.Path(os.environ[\"PLUGINS_JSON\"]).read_text())\nmanifest = plugins[\"plugins\"][\"parties\"][\"2nd\"]\n\n# SECURITY Allowlist of 2nd party orgs to pin\nfor downstream in manifest:\n    if not downstream[\"source_url\"].startswith(\"https://github.com/dffml/\"):\n        raise ValueError(f\"source_url not in allowed org: {downstream!r}\")\n\ngithub_actions_manifest = {\n    \"include\": manifest,\n}\njson_ld_manifest = {\n    \"@context\": {\n        \"@vocab\": os.environ[\"SCHEMA\"],\n    },\n    **github_actions_manifest,\n}\nprint(json.dumps(json_ld_manifest, sort_keys=True, indent=os.environ.get(\"JSON_INDENT\", None)))\n\nif \"GITHUB_OUTPUT\" in os.environ:\n    with open(os.environ[\"GITHUB_OUTPUT\"], \"a\") as fileobj:\n        fileobj.write(f'length={len(manifest)}\\n')\n        fileobj.write(f\"manifest={json.dumps(manifest, sort_keys=True)}\\n\")\n        fileobj.write(f'github_actions_manifest={json.dumps(github_actions_manifest, sort_keys=True)}\\n')\n        fileobj.write(f'json_ld_manifest={json.dumps(json_ld_manifest, sort_keys=True)}\\n')\n" [720,1866]
            FIELD [1870,4698]
                String: "pin_downstream_pep_440" [1870,1894]
                OBJECT [1895,4698]
                    FIELD [1896,1936]
                        String: "name" [1896,1902]
                        STRING [1903,1936]
                            String: "Pin downstream to latest commit" [1903,1936]
                    FIELD [1937,1962]
                        String: "runs-on" [1937,1946]
                        STRING [1947,1962]
                            String: "ubuntu-latest" [1947,1962]
                    FIELD [1963,2318]
                        String: "env" [1963,1968]
                        OBJECT [1969,2318]
                            FIELD [1970,2026]
                                String: "PIN_PULL_REQUEST_EMAIL" [1970,1994]
                                STRING [1995,2026]
                                    String: "alice.omega.alpha@outlook.com" [1995,2026]
                            FIELD [2027,2066]
                                String: "PIN_PULL_REQUEST_NAME" [2027,2050]
                                STRING [2051,2066]
                                    String: "Alice Alchemy" [2051,2066]
                            FIELD [2067,2142]
                                String: "GH_ACCESS_TOKEN" [2067,2084]
                                STRING [2085,2142]
                                    String: "${{ secrets.PIN_DOWNSTREAM_2ND_PARTY_GH_ACCESS_TOKEN }}" [2085,2142]
                            FIELD [2143,2224]
                                String: "PIN_TO_COMMIT" [2143,2158]
                                STRING [2159,2224]
                                    String: "${{ github.event.after || github.event.pull_request.head.sha }}" [2159,2224]
                            FIELD [2225,2256]
                                String: "UPSTREAM_PACKAGE_NAME" [2225,2248]
                                STRING [2249,2256]
                                    String: "dffml" [2249,2256]
                            FIELD [2257,2317]
                                String: "BUMP_DEP" [2257,2267]
                                STRING [2268,2317]
                                    String: "dffml @ https://github.com/intel/dffml/archive/" [2268,2317]
                    FIELD [2319,2339]
                        String: "needs" [2319,2326]
                        ARRAY [2327,2339]
                            STRING [2328,2338]
                                String: "manifest" [2328,2338]
                    FIELD [2340,2449]
                        String: "strategy" [2340,2350]
                        OBJECT [2351,2449]
                            FIELD [2352,2369]
                                String: "fail-fast" [2352,2363]
                                FALSE [2364,2369]
                            FIELD [2370,2388]
                                String: "max-parallel" [2370,2384]
                                NUMBER [2385,2388]
                                    Number: 100 [2385,2388]
                            FIELD [2389,2448]
                                String: "matrix" [2389,2397]
                                STRING [2398,2448]
                                    String: "${{ fromJSON(needs.manifest.outputs.manifest) }}" [2398,2448]
                    FIELD [2450,4697]
                        String: "steps" [2450,2457]
                        ARRAY [2458,4697]
                            OBJECT [2459,2837]
                                FIELD [2460,2488]
                                    String: "name" [2460,2466]
                                    STRING [2467,2488]
                                        String: "Checkout downstream" [2467,2488]
                                FIELD [2489,2619]
                                    String: "env" [2489,2494]
                                    OBJECT [2495,2619]
                                        FIELD [2496,2540]
                                            String: "TARGET_REPO_URL" [2496,2513]
                                            STRING [2514,2540]
                                                String: "${{ matrix.source_url }}" [2514,2540]
                                        FIELD [2541,2579]
                                            String: "TARGET_BRANCH" [2541,2556]
                                            STRING [2557,2579]
                                                String: "${{ matrix.branch }}" [2557,2579]
                                        FIELD [2580,2618]
                                            String: "TARGET_COMMIT" [2580,2595]
                                            STRING [2596,2618]
                                                String: "${{ matrix.branch }}" [2596,2618]
                                FIELD [2620,2836]
                                    String: "run" [2620,2625]
                                    STRING [2626,2836]
                                        String: "set -x\ngit init\ngit remote add origin \"${TARGET_REPO_URL}\"\ngit fetch origin \"${TARGET_BRANCH}\" --depth 1\ngit fetch origin \"${TARGET_COMMIT}\" --depth 1\ngit reset --hard \"origin/${TARGET_COMMIT}\"\n" [2626,2836]
                            OBJECT [2838,3064]
                                FIELD [2839,2879]
                                    String: "name" [2839,2845]
                                    STRING [2846,2879]
                                        String: "Find repo local dependent files" [2846,2879]
                                FIELD [2880,2908]
                                    String: "id" [2880,2884]
                                    STRING [2885,2908]
                                        String: "repo-local-downstream" [2885,2908]
                                FIELD [2909,3063]
                                    String: "run" [2909,2914]
                                    STRING [2915,3063]
                                        String: "set -x\nget_files() {\n  git grep \"${BUMP_DEP}\" | sed -e 's/:.*//g' | sort | uniq\n}\necho files_length=$(get_files | wc -l) >> $GITHUB_OUTPUT\n" [2915,3063]
                            OBJECT [3065,4696]
                                FIELD [3066,3119]
                                    String: "name" [3066,3072]
                                    STRING [3073,3119]
                                        String: "Update pinning of upstream within downstream" [3073,3119]
                                FIELD [3120,3196]
                                    String: "if" [3120,3124]
                                    STRING [3125,3196]
                                        String: "${{ fromJSON(steps.repo-local-downstream.outputs.files_length) > 0 }}" [3125,3196]
                                FIELD [3197,3223]
                                    String: "id" [3197,3201]
                                    STRING [3202,3223]
                                        String: "create-pull-request" [3202,3223]
                                FIELD [3224,3754]
                                    String: "env" [3224,3229]
                                    OBJECT [3230,3754]
                                        FIELD [3231,3268]
                                            String: "NEW_HASH" [3231,3241]
                                            STRING [3242,3268]
                                                String: "${{ env.PIN_TO_COMMIT }}" [3242,3268]
                                        FIELD [3269,3570]
                                            String: "COMMIT_MESSAGE" [3269,3285]
                                            STRING [3286,3570]
                                                String: "setup: Pin ${{ env.UPSTREAM_PACKAGE_NAME }} to ${{ env.PIN_TO_COMMIT }}\n${{ github.event.pull_request.html_url }}\n${{ github.server_url }}/${{ github.repository }}/commit/${{ env.PIN_TO_COMMIT }}\n${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}" [3286,3570]
                                        FIELD [3571,3656]
                                            String: "NEW_BRANCH_WITH_PIN" [3571,3592]
                                            STRING [3593,3656]
                                                String: "pin/pep_440/${{ github.repository }}/${{ env.PIN_TO_COMMIT }}" [3593,3656]
                                        FIELD [3657,3723]
                                            String: "FILES" [3657,3664]
                                            STRING [3665,3723]
                                                String: "${{ toJSON(steps.repo-local-downstream.outputs.files) }}" [3665,3723]
                                        FIELD [3724,3753]
                                            String: "BASE" [3724,3730]
                                            STRING [3731,3753]
                                                String: "${{ matrix.branch }}" [3731,3753]
                                FIELD [3755,4695]
                                    String: "run" [3755,3760]
                                    STRING [3761,4695]
                                        String: "set -x\nget_files() {\n  git grep \"${BUMP_DEP}\" | sed -e 's/:.*//g' | sort | uniq\n}\n# https://github.com/dffml/dffml-model-transformers/blob/898af4a51d9b5d70d58ce80ba2c508f3afa82400/setup.cfg#L6\nsed -i -r -e \"s#${BUMP_DEP}[A-Fa-f0-9]{40}#${BUMP_DEP}${NEW_HASH}#g\" $(get_files)\ngit checkout -b \"${NEW_BRANCH_WITH_PIN}\"\ngit config user.email \"${PIN_PULL_REQUEST_EMAIL}\"\ngit config user.name \"${PIN_PULL_REQUEST_NAME}\"\ngit commit -sam \"${COMMIT_MESSAGE}\"\ngit log -n 1 -p\necho \"${GH_ACCESS_TOKEN}\" | gh auth login --with-token\ngit push -u origin -f \"${NEW_BRANCH_WITH_PIN}\"\ngh pr create --base \"${BASE}\" --head \"${NEW_BRANCH_WITH_PIN}\" --title \"${COMMIT_MESSAGE}\" --body \"\" | tee pull-request-url\nPULL_REQUEST_URL=\"$(cat pull-request-url)\"\nif [[ \"x${PULL_REQUEST_URL}\" == \"x\" ]]; then\n  echo \"No pull request URL\" 1>&2\n  exit 1\nfi\necho \"url=${PULL_REQUEST_URL}\" | tee -a $GITHUB_OUTPUT" [3761,4695]