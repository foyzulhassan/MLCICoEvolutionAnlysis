OBJECT [0,3978]
    FIELD [1,42]
        String: "name" [1,7]
        STRING [8,42]
            String: "DFFML: Build: Images: Containers" [8,42]
    FIELD [43,390]
        String: "on" [43,47]
        OBJECT [48,390]
            FIELD [49,73]
                String: "workflow_dispatch" [49,68]
                NULL [69,73]
            FIELD [74,235]
                String: "pull_request" [74,88]
                OBJECT [89,235]
                    FIELD [90,109]
                        String: "branches" [90,100]
                        ARRAY [101,109]
                            STRING [102,108]
                                String: "main" [102,108]
                    FIELD [110,234]
                        String: "paths" [110,117]
                        ARRAY [118,234]
                            STRING [119,166]
                                String: ".github/workflows/build_images_containers.yml" [119,166]
                            STRING [167,220]
                                String: ".github/workflows/dffml_build_images_containers.yml" [167,220]
                            STRING [221,233]
                                String: "Dockerfile" [221,233]
            FIELD [236,389]
                String: "push" [236,242]
                OBJECT [243,389]
                    FIELD [244,263]
                        String: "branches" [244,254]
                        ARRAY [255,263]
                            STRING [256,262]
                                String: "main" [256,262]
                    FIELD [264,388]
                        String: "paths" [264,271]
                        ARRAY [272,388]
                            STRING [273,320]
                                String: ".github/workflows/build_images_containers.yml" [273,320]
                            STRING [321,374]
                                String: ".github/workflows/dffml_build_images_containers.yml" [321,374]
                            STRING [375,387]
                                String: "Dockerfile" [375,387]
    FIELD [391,3977]
        String: "jobs" [391,397]
        OBJECT [398,3977]
            FIELD [399,3828]
                String: "manifest" [399,409]
                OBJECT [410,3828]
                    FIELD [411,436]
                        String: "runs-on" [411,420]
                        STRING [421,436]
                            String: "ubuntu-latest" [421,436]
                    FIELD [437,516]
                        String: "outputs" [437,446]
                        OBJECT [447,516]
                            FIELD [448,515]
                                String: "manifest" [448,458]
                                STRING [459,515]
                                    String: "${{ steps.create-manifest-instance.outputs.manifest }}" [459,515]
                    FIELD [517,3827]
                        String: "steps" [517,524]
                        ARRAY [525,3827]
                            OBJECT [526,617]
                                FIELD [527,553]
                                    String: "name" [527,533]
                                    STRING [534,553]
                                        String: "Set up Python 3.9" [534,553]
                                FIELD [554,586]
                                    String: "uses" [554,560]
                                    STRING [561,586]
                                        String: "actions/setup-python@v2" [561,586]
                                FIELD [587,616]
                                    String: "with" [587,593]
                                    OBJECT [594,616]
                                        FIELD [595,615]
                                            String: "python-version" [595,611]
                                            NUMBER [612,615]
                                                Number: 3.9 [612,615]
                            OBJECT [618,648]
                                FIELD [619,647]
                                    String: "uses" [619,625]
                                    STRING [626,647]
                                        String: "actions/checkout@v3" [626,647]
                            OBJECT [649,3826]
                                FIELD [650,698]
                                    String: "name" [650,656]
                                    STRING [657,698]
                                        String: "Build manifest from changed dockerfiles" [657,698]
                                FIELD [699,730]
                                    String: "id" [699,703]
                                    STRING [704,730]
                                        String: "create-manifest-instance" [704,730]
                                FIELD [731,1052]
                                    String: "env" [731,736]
                                    OBJECT [737,1052]
                                        FIELD [738,749]
                                            String: "PREFIX" [738,746]
                                            STRING [747,749]
                                                String: "" [747,749]
                                        FIELD [750,765]
                                            String: "ROOT_PATH" [750,761]
                                            STRING [762,765]
                                                String: "." [762,765]
                                        FIELD [766,811]
                                            String: "OWNER_REPOSITORY" [766,784]
                                            STRING [785,811]
                                                String: "${{ github.repository }}" [785,811]
                                        FIELD [812,845]
                                            String: "BRANCH" [812,820]
                                            STRING [821,845]
                                                String: "${{ github.ref_name }}" [821,845]
                                        FIELD [846,904]
                                            String: "COMPARE_URL" [846,859]
                                            STRING [860,904]
                                                String: "${{ github.event.repository.compare_url }}" [860,904]
                                        FIELD [905,944]
                                            String: "GH_ACCESS_TOKEN" [905,922]
                                            STRING [923,944]
                                                String: "${{ github.token }}" [923,944]
                                        FIELD [945,979]
                                            String: "HEAD" [945,951]
                                            STRING [952,979]
                                                String: "${{ github.event.after }}" [952,979]
                                        FIELD [980,1015]
                                            String: "BASE" [980,986]
                                            STRING [987,1015]
                                                String: "${{ github.event.before }}" [987,1015]
                                        FIELD [1016,1051]
                                            String: "BASE_REF" [1016,1026]
                                            STRING [1027,1051]
                                                String: "${{ github.base_ref }}" [1027,1051]
                                FIELD [1053,1076]
                                    String: "shell" [1053,1060]
                                    STRING [1061,1076]
                                        String: "python -u {0}" [1061,1076]
                                FIELD [1077,3825]
                                    String: "run" [1077,1082]
                                    STRING [1083,3825]
                                        String: "import os\nimport json\nimport pathlib\nimport urllib.request\nowner, repository = os.environ[\"OWNER_REPOSITORY\"].split(\"/\", maxsplit=1)\nbase = None\nenv_vars = [\"BASE\", \"BASE_REF\"]\nfor env_var in env_vars:\n    if env_var in os.environ and os.environ[env_var].strip():\n        # Set if present and not blank\n        base = os.environ[env_var]\n# Empty manifest (list of manifests for each build file) in case not triggered\n# from on file change (workflow changed or dispatched).\nmanifest = []\n# Path to root of repo\nroot_path = pathlib.Path(os.environ[\"ROOT_PATH\"])\n# Must be a valid directory with .Dockerfiles in it\nprefix_path = pathlib.Path(os.environ[\"PREFIX\"])\n# Grab most recent commit to use by default\ncommit = pathlib.Path(\n    \".git\", pathlib.Path(\".git\", \"HEAD\").read_text().split()[-1],\n).read_text()\nif base is None:\n    print(f\"::notice file=dffml_build_images_containers.yml,line=1,endLine=1,title=nobase::None of {env_vars!r} found in os.environ\")\nelse:\n    compare_url = os.environ[\"COMPARE_URL\"]\n    compare_url = compare_url.replace(\"{base}\", base)\n    compare_url = compare_url.replace(\"{head}\", os.environ[\"HEAD\"])\n    with urllib.request.urlopen(\n        urllib.request.Request(\n            compare_url,\n            headers={\n                \"Authorization\": \"bearer \" + os.environ[\"GH_ACCESS_TOKEN\"],\n            },\n        )\n    ) as response:\n        response_json = json.load(response)\n    # Build the most recent commit\n    commit = response_json[\"commits\"][-1][\"sha\"]\n    manifest = list([\n        {\n            \"image_name\": pathlib.Path(compare_file[\"filename\"]).stem,\n            \"dockerfile\": compare_file[\"filename\"],\n            \"owner\": owner,\n            \"repository\": repository,\n            \"branch\": os.environ[\"BRANCH\"],\n            \"commit\": commit,\n        }\n        for compare_file in response_json[\"files\"]\n        if (\n            compare_file[\"filename\"].startswith(os.environ[\"PREFIX\"])\n            and compare_file[\"filename\"].endswith(\"Dockerfile\")\n        )\n    ])\n# Build everything if we aren't sure why we got here (alice changes or\n# workflow re-run)\nif not manifest:\n    manifest = list([\n        {\n            \"image_name\": path.stem,\n            \"dockerfile\": str(path.relative_to(root_path)),\n            \"owner\": owner,\n            \"repository\": repository,\n            \"branch\": os.environ[\"BRANCH\"],\n            \"commit\": commit,\n        }\n        for path in prefix_path.glob(\"*Dockerfile\")\n    ])\nprint(json.dumps(manifest, sort_keys=True, indent=4))\nprint(\"::set-output name=manifest::\" + json.dumps({\"include\": manifest}))\n" [1083,3825]
            FIELD [3829,3976]
                String: "build" [3829,3836]
                OBJECT [3837,3976]
                    FIELD [3838,3856]
                        String: "needs" [3838,3845]
                        STRING [3846,3856]
                            String: "manifest" [3846,3856]
                    FIELD [3857,3913]
                        String: "uses" [3857,3863]
                        STRING [3864,3913]
                            String: "./.github/workflows/build_images_containers.yml" [3864,3913]
                    FIELD [3914,3975]
                        String: "with" [3914,3920]
                        OBJECT [3921,3975]
                            FIELD [3922,3974]
                                String: "manifests" [3922,3933]
                                STRING [3934,3974]
                                    String: "${{ needs.manifest.outputs.manifest }}" [3934,3974]