OBJECT [0,6058]
    FIELD [1,21]
        String: "name" [1,7]
        STRING [8,21]
            String: "Build on M1" [8,21]
    FIELD [22,215]
        String: "on" [22,26]
        OBJECT [27,215]
            FIELD [28,96]
                String: "pull_request" [28,42]
                OBJECT [43,96]
                    FIELD [44,95]
                        String: "paths" [44,51]
                        ARRAY [52,95]
                            STRING [53,94]
                                String: ".github/workflows/build-m1-binaries.yml" [53,94]
            FIELD [97,189]
                String: "push" [97,103]
                OBJECT [104,189]
                    FIELD [105,146]
                        String: "branches" [105,115]
                        ARRAY [116,146]
                            STRING [117,126]
                                String: "nightly" [117,126]
                            STRING [127,133]
                                String: "main" [127,133]
                            STRING [134,145]
                                String: "release/*" [134,145]
                    FIELD [147,188]
                        String: "tags" [147,153]
                        ARRAY [154,188]
                            STRING [155,187]
                                String: "v[0-9]+.[0-9]+.[0-9]+-rc[0-9]+" [155,187]
            FIELD [190,214]
                String: "workflow_dispatch" [190,209]
                NULL [210,214]
    FIELD [216,243]
        String: "env" [216,221]
        OBJECT [222,243]
            FIELD [223,242]
                String: "CHANNEL" [223,232]
                STRING [233,242]
                    String: "nightly" [233,242]
    FIELD [244,6057]
        String: "jobs" [244,250]
        OBJECT [251,6057]
            FIELD [252,3812]
                String: "build_wheels" [252,266]
                OBJECT [267,3812]
                    FIELD [268,304]
                        String: "name" [268,274]
                        STRING [275,304]
                            String: "Build TorchVision M1 wheels" [275,304]
                    FIELD [305,328]
                        String: "runs-on" [305,314]
                        STRING [315,328]
                            String: "macos-m1-12" [315,328]
                    FIELD [329,383]
                        String: "strategy" [329,339]
                        OBJECT [340,383]
                            FIELD [341,382]
                                String: "matrix" [341,349]
                                OBJECT [350,382]
                                    FIELD [351,381]
                                        String: "py_vers" [351,360]
                                        ARRAY [361,381]
                                            STRING [362,367]
                                                String: "3.8" [362,367]
                                            STRING [368,373]
                                                String: "3.9" [368,373]
                                            STRING [374,380]
                                                String: "3.10" [374,380]
                    FIELD [384,3811]
                        String: "steps" [384,391]
                        ARRAY [392,3811]
                            OBJECT [393,452]
                                FIELD [394,422]
                                    String: "name" [394,400]
                                    STRING [401,422]
                                        String: "Checkout repository" [401,422]
                                FIELD [423,451]
                                    String: "uses" [423,429]
                                    STRING [430,451]
                                        String: "actions/checkout@v2" [430,451]
                            OBJECT [453,729]
                                FIELD [454,499]
                                    String: "name" [454,460]
                                    STRING [461,499]
                                        String: "Set CHANNEL (only for tagged pushes)" [461,499]
                                FIELD [500,587]
                                    String: "if" [500,504]
                                    STRING [505,587]
                                        String: "${{ github.event_name == 'push' && startsWith(github.event.ref, 'refs/tags/') }}" [505,587]
                                FIELD [588,728]
                                    String: "run" [588,593]
                                    STRING [594,728]
                                        String: "# reference ends with an RC suffix\nif [[ ${GITHUB_REF_NAME} = *-rc[0-9]* ]]; then\n  echo \"CHANNEL=test\" >> \"$GITHUB_ENV\"\nfi\n" [594,728]
                            OBJECT [730,967]
                                FIELD [731,773]
                                    String: "name" [731,737]
                                    STRING [738,773]
                                        String: "Set Release CHANNEL (for release)" [738,773]
                                FIELD [774,915]
                                    String: "if" [774,778]
                                    STRING [779,915]
                                        String: "${{ (github.event_name == 'pull_request' && startsWith(github.base_ref, 'release')) || startsWith(github.ref, 'refs/heads/release') }}" [779,915]
                                FIELD [916,966]
                                    String: "run" [916,921]
                                    STRING [922,966]
                                        String: "echo \"CHANNEL=test\" >> \"$GITHUB_ENV\"\n" [922,966]
                            OBJECT [968,1059]
                                FIELD [969,993]
                                    String: "name" [969,975]
                                    STRING [976,993]
                                        String: "Setup miniconda" [976,993]
                                FIELD [994,1058]
                                    String: "uses" [994,1000]
                                    STRING [1001,1058]
                                        String: "pytorch/test-infra/.github/actions/setup-miniconda@main" [1001,1058]
                            OBJECT [1060,2196]
                                FIELD [1061,1096]
                                    String: "name" [1061,1067]
                                    STRING [1068,1096]
                                        String: "Build TorchVision M1 wheel" [1068,1096]
                                FIELD [1097,1132]
                                    String: "shell" [1097,1104]
                                    STRING [1105,1132]
                                        String: "arch -arch arm64 bash {0}" [1105,1132]
                                FIELD [1133,1218]
                                    String: "env" [1133,1138]
                                    OBJECT [1139,1218]
                                        FIELD [1140,1183]
                                            String: "ENV_NAME" [1140,1150]
                                            STRING [1151,1183]
                                                String: "conda-env-${{ github.run_id }}" [1151,1183]
                                        FIELD [1184,1217]
                                            String: "PY_VERS" [1184,1193]
                                            STRING [1194,1217]
                                                String: "${{ matrix.py_vers }}" [1194,1217]
                                FIELD [1219,2195]
                                    String: "run" [1219,1224]
                                    STRING [1225,2195]
                                        String: "# Needed for JPEG library detection as setup.py detects conda presence by running `shutil.which('conda')`\nset -ex\n. packaging/pkg_helpers.bash\n# if we are uploading to test channell, our version consist only of the base: 0.x.x - no date string or suffix added\nif [[ $CHANNEL == \"test\" ]]; then\n  setup_base_build_version\nelse\n  setup_build_version\nfi\n\nconda create -yp ${ENV_NAME} python=${PY_VERS} numpy libpng jpeg wheel pkg-config\nconda run -p ${ENV_NAME} python3 -mpip install torch --pre --extra-index-url=https://download.pytorch.org/whl/${CHANNEL}\nconda run -p ${ENV_NAME} python3 -mpip install delocate\nconda run -p ${ENV_NAME} python3 setup.py bdist_wheel\nexport PYTORCH_VERSION=\"$(conda run -p ${ENV_NAME} python3 -mpip show torch | grep ^Version: | sed 's/Version:  *//')\"\nconda run -p ${ENV_NAME} DYLD_FALLBACK_LIBRARY_PATH=\"${ENV_NAME}/lib\" delocate-wheel -v --ignore-missing-dependencies dist/*.whl\nconda env remove -p ${ENV_NAME}\n" [1225,2195]
                            OBJECT [2197,3185]
                                FIELD [2198,2217]
                                    String: "name" [2198,2204]
                                    STRING [2205,2217]
                                        String: "Test wheel" [2205,2217]
                                FIELD [2218,2253]
                                    String: "shell" [2218,2225]
                                    STRING [2226,2253]
                                        String: "arch -arch arm64 bash {0}" [2226,2253]
                                FIELD [2254,2344]
                                    String: "env" [2254,2259]
                                    OBJECT [2260,2344]
                                        FIELD [2261,2309]
                                            String: "ENV_NAME" [2261,2271]
                                            STRING [2272,2309]
                                                String: "conda-test-env-${{ github.run_id }}" [2272,2309]
                                        FIELD [2310,2343]
                                            String: "PY_VERS" [2310,2319]
                                            STRING [2320,2343]
                                                String: "${{ matrix.py_vers }}" [2320,2343]
                                FIELD [2345,3184]
                                    String: "run" [2345,2350]
                                    STRING [2351,3184]
                                        String: "set -ex\nconda create -yp ${ENV_NAME} python=${PY_VERS} numpy\nconda run -p ${ENV_NAME} python3 -mpip install torch --pre --extra-index-url=https://download.pytorch.org/whl/${CHANNEL}\nconda run -p ${ENV_NAME} python3 -mpip install dist/*.whl\n# Test torch is importable, by changing cwd and running import commands\nconda run --cwd /tmp -p ${ENV_NAME} python3 -c \"import torchvision;print('torchvision version is ', torchvision.__version__)\"\nconda run --cwd /tmp -p ${ENV_NAME} python3 -c \"import torch;import torchvision;print('Is torchvision useable?', all(x is not None for x in [torch.ops.image.decode_png, torch.ops.torchvision.roi_align]))\"\nconda run --cwd /tmp -p ${ENV_NAME} python3 -c \"import torchvision;print(torchvision.io.read_image('${PWD}/gallery/assets/dog1.jpg').shape)\"\nconda env remove -p ${ENV_NAME}\n" [2351,3184]
                            OBJECT [3186,3335]
                                FIELD [3187,3218]
                                    String: "name" [3187,3193]
                                    STRING [3194,3218]
                                        String: "Upload wheel to GitHub" [3194,3218]
                                FIELD [3219,3254]
                                    String: "uses" [3219,3225]
                                    STRING [3226,3254]
                                        String: "actions/upload-artifact@v3" [3226,3254]
                                FIELD [3255,3334]
                                    String: "with" [3255,3261]
                                    OBJECT [3262,3334]
                                        FIELD [3263,3318]
                                            String: "name" [3263,3269]
                                            STRING [3270,3318]
                                                String: "torchvision-py${{ matrix.py_vers }}-macos11-m1" [3270,3318]
                                        FIELD [3319,3333]
                                            String: "path" [3319,3325]
                                            STRING [3326,3333]
                                                String: "dist/" [3326,3333]
                            OBJECT [3336,3810]
                                FIELD [3337,3364]
                                    String: "name" [3337,3343]
                                    STRING [3344,3364]
                                        String: "Upload wheel to S3" [3344,3364]
                                FIELD [3365,3498]
                                    String: "if" [3365,3369]
                                    STRING [3370,3498]
                                        String: "${{ github.event_name == 'push' && (github.event.ref == 'refs/heads/nightly' || startsWith(github.event.ref, 'refs/tags/')) }}" [3370,3498]
                                FIELD [3499,3534]
                                    String: "shell" [3499,3506]
                                    STRING [3507,3534]
                                        String: "arch -arch arm64 bash {0}" [3507,3534]
                                FIELD [3535,3694]
                                    String: "env" [3535,3540]
                                    OBJECT [3541,3694]
                                        FIELD [3542,3613]
                                            String: "AWS_ACCESS_KEY_ID" [3542,3561]
                                            STRING [3562,3613]
                                                String: "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}" [3562,3613]
                                        FIELD [3614,3693]
                                            String: "AWS_SECRET_ACCESS_KEY" [3614,3637]
                                            STRING [3638,3693]
                                                String: "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}" [3638,3693]
                                FIELD [3695,3809]
                                    String: "run" [3695,3700]
                                    STRING [3701,3809]
                                        String: "for pkg in dist/*; do\n  aws s3 cp \"$pkg\" \"s3://pytorch/whl/${CHANNEL}/cpu/\" --acl public-read\ndone\n" [3701,3809]
            FIELD [3813,6056]
                String: "build_conda" [3813,3826]
                OBJECT [3827,6056]
                    FIELD [3828,3872]
                        String: "name" [3828,3834]
                        STRING [3835,3872]
                            String: "Build TorchVision M1 conda packages" [3835,3872]
                    FIELD [3873,3896]
                        String: "runs-on" [3873,3882]
                        STRING [3883,3896]
                            String: "macos-m1-12" [3883,3896]
                    FIELD [3897,3951]
                        String: "strategy" [3897,3907]
                        OBJECT [3908,3951]
                            FIELD [3909,3950]
                                String: "matrix" [3909,3917]
                                OBJECT [3918,3950]
                                    FIELD [3919,3949]
                                        String: "py_vers" [3919,3928]
                                        ARRAY [3929,3949]
                                            STRING [3930,3935]
                                                String: "3.8" [3930,3935]
                                            STRING [3936,3941]
                                                String: "3.9" [3936,3941]
                                            STRING [3942,3948]
                                                String: "3.10" [3942,3948]
                    FIELD [3952,6055]
                        String: "steps" [3952,3959]
                        ARRAY [3960,6055]
                            OBJECT [3961,4020]
                                FIELD [3962,3990]
                                    String: "name" [3962,3968]
                                    STRING [3969,3990]
                                        String: "Checkout repository" [3969,3990]
                                FIELD [3991,4019]
                                    String: "uses" [3991,3997]
                                    STRING [3998,4019]
                                        String: "actions/checkout@v2" [3998,4019]
                            OBJECT [4021,4297]
                                FIELD [4022,4067]
                                    String: "name" [4022,4028]
                                    STRING [4029,4067]
                                        String: "Set CHANNEL (only for tagged pushes)" [4029,4067]
                                FIELD [4068,4155]
                                    String: "if" [4068,4072]
                                    STRING [4073,4155]
                                        String: "${{ github.event_name == 'push' && startsWith(github.event.ref, 'refs/tags/') }}" [4073,4155]
                                FIELD [4156,4296]
                                    String: "run" [4156,4161]
                                    STRING [4162,4296]
                                        String: "# reference ends with an RC suffix\nif [[ ${GITHUB_REF_NAME} = *-rc[0-9]* ]]; then\n  echo \"CHANNEL=test\" >> \"$GITHUB_ENV\"\nfi\n" [4162,4296]
                            OBJECT [4298,4535]
                                FIELD [4299,4341]
                                    String: "name" [4299,4305]
                                    STRING [4306,4341]
                                        String: "Set CHANNEL Release (for release)" [4306,4341]
                                FIELD [4342,4483]
                                    String: "if" [4342,4346]
                                    STRING [4347,4483]
                                        String: "${{ (github.event_name == 'pull_request' && startsWith(github.base_ref, 'release')) || startsWith(github.ref, 'refs/heads/release') }}" [4347,4483]
                                FIELD [4484,4534]
                                    String: "run" [4484,4489]
                                    STRING [4490,4534]
                                        String: "echo \"CHANNEL=test\" >> \"$GITHUB_ENV\"\n" [4490,4534]
                            OBJECT [4536,4627]
                                FIELD [4537,4561]
                                    String: "name" [4537,4543]
                                    STRING [4544,4561]
                                        String: "Setup miniconda" [4544,4561]
                                FIELD [4562,4626]
                                    String: "uses" [4562,4568]
                                    STRING [4569,4626]
                                        String: "pytorch/test-infra/.github/actions/setup-miniconda@main" [4569,4626]
                            OBJECT [4628,4786]
                                FIELD [4629,4686]
                                    String: "name" [4629,4635]
                                    STRING [4636,4686]
                                        String: "Install conda-build and purge previous artifacts" [4636,4686]
                                FIELD [4687,4722]
                                    String: "shell" [4687,4694]
                                    STRING [4695,4722]
                                        String: "arch -arch arm64 bash {0}" [4695,4722]
                                FIELD [4723,4785]
                                    String: "run" [4723,4728]
                                    STRING [4729,4785]
                                        String: "conda install -yq conda-build\nconda build purge-all\n" [4729,4785]
                            OBJECT [4787,5369]
                                FIELD [4788,4831]
                                    String: "name" [4788,4794]
                                    STRING [4795,4831]
                                        String: "Build TorchVision M1 conda package" [4795,4831]
                                FIELD [4832,4867]
                                    String: "shell" [4832,4839]
                                    STRING [4840,4867]
                                        String: "arch -arch arm64 bash {0}" [4840,4867]
                                FIELD [4868,4979]
                                    String: "env" [4868,4873]
                                    OBJECT [4874,4979]
                                        FIELD [4875,4918]
                                            String: "ENV_NAME" [4875,4885]
                                            STRING [4886,4918]
                                                String: "conda-env-${{ github.run_id }}" [4886,4918]
                                        FIELD [4919,4959]
                                            String: "PYTHON_VERSION" [4919,4935]
                                            STRING [4936,4959]
                                                String: "${{ matrix.py_vers }}" [4936,4959]
                                        FIELD [4960,4978]
                                            String: "CU_VERSION" [4960,4972]
                                            STRING [4973,4978]
                                                String: "cpu" [4973,4978]
                                FIELD [4980,5368]
                                    String: "run" [4980,4985]
                                    STRING [4986,5368]
                                        String: "set -ex\n. packaging/pkg_helpers.bash\n\nif [[ $CHANNEL == \"test\" ]]; then\n  setup_base_build_version\nelse\n  setup_build_version\nfi\n\nsetup_conda_pytorch_constraint\nexport SOURCE_ROOT_DIR=$(pwd)\nconda build \\\n  -c defaults \\\n  $CONDA_CHANNEL_FLAGS \\\n  --no-anaconda-upload \\\n  --python \"$PYTHON_VERSION\" \\\n  --output-folder=dist/ \\\n  packaging/torchvision\n" [4986,5368]
                            OBJECT [5370,5527]
                                FIELD [5371,5404]
                                    String: "name" [5371,5377]
                                    STRING [5378,5404]
                                        String: "Upload package to GitHub" [5378,5404]
                                FIELD [5405,5440]
                                    String: "uses" [5405,5411]
                                    STRING [5412,5440]
                                        String: "actions/upload-artifact@v3" [5412,5440]
                                FIELD [5441,5526]
                                    String: "with" [5441,5447]
                                    OBJECT [5448,5526]
                                        FIELD [5449,5510]
                                            String: "name" [5449,5455]
                                            STRING [5456,5510]
                                                String: "torchvision-py${{ matrix.py_vers }}-macos11-m1-conda" [5456,5510]
                                        FIELD [5511,5525]
                                            String: "path" [5511,5517]
                                            STRING [5518,5525]
                                                String: "dist/" [5518,5525]
                            OBJECT [5528,6054]
                                FIELD [5529,5561]
                                    String: "name" [5529,5535]
                                    STRING [5536,5561]
                                        String: "Upload package to conda" [5536,5561]
                                FIELD [5562,5695]
                                    String: "if" [5562,5566]
                                    STRING [5567,5695]
                                        String: "${{ github.event_name == 'push' && (github.event.ref == 'refs/heads/nightly' || startsWith(github.event.ref, 'refs/tags/')) }}" [5567,5695]
                                FIELD [5696,5731]
                                    String: "shell" [5696,5703]
                                    STRING [5704,5731]
                                        String: "arch -arch arm64 bash {0}" [5704,5731]
                                FIELD [5732,5804]
                                    String: "env" [5732,5737]
                                    OBJECT [5738,5804]
                                        FIELD [5739,5803]
                                            String: "CONDA_PYTORCHBOT_TOKEN" [5739,5763]
                                            STRING [5764,5803]
                                                String: "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}" [5764,5803]
                                FIELD [5805,6053]
                                    String: "run" [5805,5810]
                                    STRING [5811,6053]
                                        String: "conda install -yq anaconda-client\nset -x\nexport ANACONDA_PATH=$(conda info --base)/bin\n$ANACONDA_PATH/anaconda  -t \"${CONDA_PYTORCHBOT_TOKEN}\" upload dist/osx-arm64/*.tar.bz2 -u \"pytorch-${CHANNEL}\" --label main --no-progress --force" [5811,6053]