OBJECT [0,4942]
    FIELD [1,36]
        String: "name" [1,7]
        STRING [8,36]
            String: "Pin: Downstream: 2nd party" [8,36]
    FIELD [37,160]
        String: "on" [37,41]
        OBJECT [42,160]
            FIELD [43,130]
                String: "pull_request_target" [43,64]
                OBJECT [65,130]
                    FIELD [66,109]
                        String: "types" [66,73]
                        ARRAY [74,109]
                            STRING [75,83]
                                String: "opened" [75,83]
                            STRING [84,97]
                                String: "synchronize" [84,97]
                            STRING [98,108]
                                String: "reopened" [98,108]
                    FIELD [110,129]
                        String: "branches" [110,120]
                        ARRAY [121,129]
                            STRING [122,128]
                                String: "main" [122,128]
            FIELD [131,159]
                String: "push" [131,137]
                OBJECT [138,159]
                    FIELD [139,158]
                        String: "branches" [139,149]
                        ARRAY [150,158]
                            STRING [151,157]
                                String: "main" [151,157]
    FIELD [161,4941]
        String: "jobs" [161,167]
        OBJECT [168,4941]
            FIELD [169,1880]
                String: "manifest" [169,179]
                OBJECT [180,1880]
                    FIELD [181,206]
                        String: "runs-on" [181,190]
                        STRING [191,206]
                            String: "ubuntu-latest" [191,206]
                    FIELD [207,217]
                        String: "if" [207,211]
                        FALSE [212,217]
                    FIELD [218,376]
                        String: "outputs" [218,227]
                        OBJECT [228,376]
                            FIELD [229,292]
                                String: "length" [229,237]
                                STRING [238,292]
                                    String: "${{ steps.create-manifest-instance.outputs.length }}" [238,292]
                            FIELD [293,375]
                                String: "manifest" [293,303]
                                STRING [304,375]
                                    String: "${{ steps.create-manifest-instance.outputs.github_actions_manifest }}" [304,375]
                    FIELD [377,1879]
                        String: "steps" [377,384]
                        ARRAY [385,1879]
                            OBJECT [386,476]
                                FIELD [387,409]
                                    String: "name" [387,393]
                                    STRING [394,409]
                                        String: "Set up Python" [394,409]
                                FIELD [410,442]
                                    String: "uses" [410,416]
                                    STRING [417,442]
                                        String: "actions/setup-python@v4" [417,442]
                                FIELD [443,475]
                                    String: "with" [443,449]
                                    OBJECT [450,475]
                                        FIELD [451,474]
                                            String: "python-version" [451,467]
                                            STRING [468,474]
                                                String: "3.11" [468,474]
                            OBJECT [477,507]
                                FIELD [478,506]
                                    String: "uses" [478,484]
                                    STRING [485,506]
                                        String: "actions/checkout@v3" [485,506]
                            OBJECT [508,1878]
                                FIELD [509,568]
                                    String: "name" [509,515]
                                    STRING [516,568]
                                        String: "Build manifest from plugins.json from pull request" [516,568]
                                FIELD [569,600]
                                    String: "id" [569,573]
                                    STRING [574,600]
                                        String: "create-manifest-instance" [574,600]
                                FIELD [601,700]
                                    String: "env" [601,606]
                                    OBJECT [607,700]
                                        FIELD [608,643]
                                            String: "PLUGINS_JSON" [608,622]
                                            STRING [623,643]
                                                String: "dffml/plugins.json" [623,643]
                                        FIELD [644,678]
                                            String: "SCHEMA" [644,652]
                                            STRING [653,678]
                                                String: "TODO-dffml-2ndparty-pin" [653,678]
                                        FIELD [679,699]
                                            String: "JSON_INDENT" [679,692]
                                            STRING [693,699]
                                                String: "    " [693,699]
                                FIELD [701,724]
                                    String: "shell" [701,708]
                                    STRING [709,724]
                                        String: "python -u {0}" [709,724]
                                FIELD [725,1877]
                                    String: "run" [725,730]
                                    STRING [731,1877]
                                        String: "import os\nimport json\nimport pathlib\n\nplugins = json.loads(pathlib.Path(os.environ[\"PLUGINS_JSON\"]).read_text())\nmanifest = plugins[\"plugins\"][\"parties\"][\"2nd\"]\n\n# SECURITY Allowlist of 2nd party orgs to pin\nfor downstream in manifest:\n    if not downstream[\"source_url\"].startswith(\"https://github.com/dffml/\"):\n        raise ValueError(f\"source_url not in allowed org: {downstream!r}\")\n\ngithub_actions_manifest = {\n    \"include\": manifest,\n}\njson_ld_manifest = {\n    \"@context\": {\n        \"@vocab\": os.environ[\"SCHEMA\"],\n    },\n    **github_actions_manifest,\n}\nprint(json.dumps(json_ld_manifest, sort_keys=True, indent=os.environ.get(\"JSON_INDENT\", None)))\n\nif \"GITHUB_OUTPUT\" in os.environ:\n    with open(os.environ[\"GITHUB_OUTPUT\"], \"a\") as fileobj:\n        fileobj.write(f'length={len(manifest)}\\n')\n        fileobj.write(f\"manifest={json.dumps(manifest, sort_keys=True)}\\n\")\n        fileobj.write(f'github_actions_manifest={json.dumps(github_actions_manifest, sort_keys=True)}\\n')\n        fileobj.write(f'json_ld_manifest={json.dumps(json_ld_manifest, sort_keys=True)}\\n')\n" [731,1877]
            FIELD [1881,4940]
                String: "pin_downstream_pep_440" [1881,1905]
                OBJECT [1906,4940]
                    FIELD [1907,1947]
                        String: "name" [1907,1913]
                        STRING [1914,1947]
                            String: "Pin downstream to latest commit" [1914,1947]
                    FIELD [1948,1973]
                        String: "runs-on" [1948,1957]
                        STRING [1958,1973]
                            String: "ubuntu-latest" [1958,1973]
                    FIELD [1974,1984]
                        String: "if" [1974,1978]
                        FALSE [1979,1984]
                    FIELD [1985,2340]
                        String: "env" [1985,1990]
                        OBJECT [1991,2340]
                            FIELD [1992,2048]
                                String: "PIN_PULL_REQUEST_EMAIL" [1992,2016]
                                STRING [2017,2048]
                                    String: "alice.omega.alpha@outlook.com" [2017,2048]
                            FIELD [2049,2088]
                                String: "PIN_PULL_REQUEST_NAME" [2049,2072]
                                STRING [2073,2088]
                                    String: "Alice Alchemy" [2073,2088]
                            FIELD [2089,2164]
                                String: "GH_ACCESS_TOKEN" [2089,2106]
                                STRING [2107,2164]
                                    String: "${{ secrets.PIN_DOWNSTREAM_2ND_PARTY_GH_ACCESS_TOKEN }}" [2107,2164]
                            FIELD [2165,2246]
                                String: "PIN_TO_COMMIT" [2165,2180]
                                STRING [2181,2246]
                                    String: "${{ github.event.after || github.event.pull_request.head.sha }}" [2181,2246]
                            FIELD [2247,2278]
                                String: "UPSTREAM_PACKAGE_NAME" [2247,2270]
                                STRING [2271,2278]
                                    String: "dffml" [2271,2278]
                            FIELD [2279,2339]
                                String: "BUMP_DEP" [2279,2289]
                                STRING [2290,2339]
                                    String: "dffml @ https://github.com/intel/dffml/archive/" [2290,2339]
                    FIELD [2341,2361]
                        String: "needs" [2341,2348]
                        ARRAY [2349,2361]
                            STRING [2350,2360]
                                String: "manifest" [2350,2360]
                    FIELD [2362,2471]
                        String: "strategy" [2362,2372]
                        OBJECT [2373,2471]
                            FIELD [2374,2391]
                                String: "fail-fast" [2374,2385]
                                FALSE [2386,2391]
                            FIELD [2392,2410]
                                String: "max-parallel" [2392,2406]
                                NUMBER [2407,2410]
                                    Number: 100 [2407,2410]
                            FIELD [2411,2470]
                                String: "matrix" [2411,2419]
                                STRING [2420,2470]
                                    String: "${{ fromJSON(needs.manifest.outputs.manifest) }}" [2420,2470]
                    FIELD [2472,4939]
                        String: "steps" [2472,2479]
                        ARRAY [2480,4939]
                            OBJECT [2481,2859]
                                FIELD [2482,2510]
                                    String: "name" [2482,2488]
                                    STRING [2489,2510]
                                        String: "Checkout downstream" [2489,2510]
                                FIELD [2511,2641]
                                    String: "env" [2511,2516]
                                    OBJECT [2517,2641]
                                        FIELD [2518,2562]
                                            String: "TARGET_REPO_URL" [2518,2535]
                                            STRING [2536,2562]
                                                String: "${{ matrix.source_url }}" [2536,2562]
                                        FIELD [2563,2601]
                                            String: "TARGET_BRANCH" [2563,2578]
                                            STRING [2579,2601]
                                                String: "${{ matrix.branch }}" [2579,2601]
                                        FIELD [2602,2640]
                                            String: "TARGET_COMMIT" [2602,2617]
                                            STRING [2618,2640]
                                                String: "${{ matrix.branch }}" [2618,2640]
                                FIELD [2642,2858]
                                    String: "run" [2642,2647]
                                    STRING [2648,2858]
                                        String: "set -x\ngit init\ngit remote add origin \"${TARGET_REPO_URL}\"\ngit fetch origin \"${TARGET_BRANCH}\" --depth 1\ngit fetch origin \"${TARGET_COMMIT}\" --depth 1\ngit reset --hard \"origin/${TARGET_COMMIT}\"\n" [2648,2858]
                            OBJECT [2860,3086]
                                FIELD [2861,2901]
                                    String: "name" [2861,2867]
                                    STRING [2868,2901]
                                        String: "Find repo local dependent files" [2868,2901]
                                FIELD [2902,2930]
                                    String: "id" [2902,2906]
                                    STRING [2907,2930]
                                        String: "repo-local-downstream" [2907,2930]
                                FIELD [2931,3085]
                                    String: "run" [2931,2936]
                                    STRING [2937,3085]
                                        String: "set -x\nget_files() {\n  git grep \"${BUMP_DEP}\" | sed -e 's/:.*//g' | sort | uniq\n}\necho files_length=$(get_files | wc -l) >> $GITHUB_OUTPUT\n" [2937,3085]
                            OBJECT [3087,4938]
                                FIELD [3088,3141]
                                    String: "name" [3088,3094]
                                    STRING [3095,3141]
                                        String: "Update pinning of upstream within downstream" [3095,3141]
                                FIELD [3142,3218]
                                    String: "if" [3142,3146]
                                    STRING [3147,3218]
                                        String: "${{ fromJSON(steps.repo-local-downstream.outputs.files_length) > 0 }}" [3147,3218]
                                FIELD [3219,3245]
                                    String: "id" [3219,3223]
                                    STRING [3224,3245]
                                        String: "create-pull-request" [3224,3245]
                                FIELD [3246,3776]
                                    String: "env" [3246,3251]
                                    OBJECT [3252,3776]
                                        FIELD [3253,3290]
                                            String: "NEW_HASH" [3253,3263]
                                            STRING [3264,3290]
                                                String: "${{ env.PIN_TO_COMMIT }}" [3264,3290]
                                        FIELD [3291,3592]
                                            String: "COMMIT_MESSAGE" [3291,3307]
                                            STRING [3308,3592]
                                                String: "setup: Pin ${{ env.UPSTREAM_PACKAGE_NAME }} to ${{ env.PIN_TO_COMMIT }}\n${{ github.event.pull_request.html_url }}\n${{ github.server_url }}/${{ github.repository }}/commit/${{ env.PIN_TO_COMMIT }}\n${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}" [3308,3592]
                                        FIELD [3593,3678]
                                            String: "NEW_BRANCH_WITH_PIN" [3593,3614]
                                            STRING [3615,3678]
                                                String: "pin/pep_440/${{ github.repository }}/${{ env.PIN_TO_COMMIT }}" [3615,3678]
                                        FIELD [3679,3745]
                                            String: "FILES" [3679,3686]
                                            STRING [3687,3745]
                                                String: "${{ toJSON(steps.repo-local-downstream.outputs.files) }}" [3687,3745]
                                        FIELD [3746,3775]
                                            String: "BASE" [3746,3752]
                                            STRING [3753,3775]
                                                String: "${{ matrix.branch }}" [3753,3775]
                                FIELD [3777,4937]
                                    String: "run" [3777,3782]
                                    STRING [3783,4937]
                                        String: "set -x\nget_files() {\n  git grep \"${BUMP_DEP}\" | sed -e 's/:.*//g' | sort | uniq\n}\n# https://github.com/dffml/dffml-model-transformers/blob/898af4a51d9b5d70d58ce80ba2c508f3afa82400/setup.cfg#L6\nsed -i -r -e \"s#${BUMP_DEP}[A-Fa-f0-9]{40}#${BUMP_DEP}${NEW_HASH}#g\" $(get_files)\ngit checkout -b \"${NEW_BRANCH_WITH_PIN}\"\ngit config user.email \"${PIN_PULL_REQUEST_EMAIL}\"\ngit config user.name \"${PIN_PULL_REQUEST_NAME}\"\ngit commit -sam \"${COMMIT_MESSAGE}\"\ngit log -n 1 -p\n\nmkdir -p ~/.config/gh/\necho \"github.com:\" > ~/.config/gh/hosts.yml\necho \"    oauth_token: ${GH_ACCESS_TOKEN}\" >> ~/.config/gh/hosts.yml\necho \"    user: token\" >> ~/.config/gh/hosts.yml\necho \"    git_protocol: https\" >> ~/.config/gh/hosts.yml\ngh auth setup-git\n\ngit push -u origin -f \"${NEW_BRANCH_WITH_PIN}\"\ngh pr create --base \"${BASE}\" --head \"${NEW_BRANCH_WITH_PIN}\" --title \"${COMMIT_MESSAGE}\" --body \"\" | tee pull-request-url\nPULL_REQUEST_URL=\"$(cat pull-request-url)\"\nif [[ \"x${PULL_REQUEST_URL}\" == \"x\" ]]; then\n  echo \"No pull request URL\" 1>&2\n  exit 1\nfi\necho \"url=${PULL_REQUEST_URL}\" | tee -a $GITHUB_OUTPUT" [3783,4937]